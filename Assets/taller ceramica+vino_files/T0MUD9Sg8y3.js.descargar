;/*FB_PKG_DELIM*/

__d("LSRemoveBlindedTokens",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(308).fetch(),function(b){return b.configId===a[0]}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSRemoveUsedTokens",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(a){return b.forEach(b.filter(b.db.table(309).fetch(),function(a){return b.i64.le(a.redeemLimit,b.i64.cast([0,0]))}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSGetCurrentTokenPoolState",["LSArrayGetObjectAt","LSRemoveBlindedTokens","LSRemoveUsedTokens"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),d[1]=c.createArray(),c.count(c.filter(c.db.table(307).fetch(),function(b){return b.projectName===a[0]})).then(function(a){return d[2]=a})},function(b){return c.forEach(c.filter(c.db.table(307).fetch(),function(b){return b.projectName===a[0]}),function(a){a=a.item;return d[7]=a.configId,c.i64.gt(d[0],a.expirationTimestampMs)?c.forEach(c.db.table(307).fetch([[[d[7]]]]),function(a){return a["delete"]()}):c.resolve(d[8]=(d[1].push(d[7]),d[1]))})},function(a){return c.storedProcedure(b("LSRemoveUsedTokens"))},function(a){return d[3]=c.i64.cast([0,0]),d[4]=c.i64.of_int32(d[1].length),c.i64.gt(d[4],c.i64.cast([0,0]))?c.loopAsync(d[4],function(a){return d[7]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[1],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.count(c.filter(c.db.table(309).fetch(),function(a){return a.configId===d[8]})).then(function(a){return d[10]=a})},function(a){return d[3]=c.i64.add(d[10],d[3]),c.storedProcedure(b("LSRemoveBlindedTokens"),d[8])}])}):c.resolve()},function(a){return c.i64.gt(d[2],c.i64.cast([0,0]))?(d[7]=c.i64.of_int32(d[1].length),d[5]=c.i64.ge(d[7],c.i64.cast([0,1]))):d[5]=void 0,d[5]!==void 0?(d[5]?(c.i64.gt(d[3],c.i64.cast([0,0]))?d[8]=c.i64.cast([0,3]):d[8]=c.i64.cast([0,2]),d[7]=d[8]):d[7]=c.i64.cast([0,1]),d[6]=d[7]):d[6]=c.i64.cast([0,0]),a=[d[6],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSIssueNextSync",["LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return c.count(c.filter(c.db.table(310).fetch(),function(b){return b.projectName===a[1]})).then(function(a){return d[0]=a})},function(e){return c.i64.gt(d[0],c.i64.cast([0,0]))&&a[3]===!0?c.resolve(0):c.sequence([function(b){return c.forEach(c.filter(c.db.table(310).fetch(),function(b){return b.projectName===a[1]}),function(a){return a["delete"]()})},function(e){return c.i64.gt(a[2],c.i64.cast([0,0]))?(d[3]=c.i64.of_float(Date.now()),d[1]=c.i64.add(d[3],a[2])):d[1]=c.i64.cast([0,0]),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["acs_sync","_",a[1]].join(""),c.i64.cast([0,362]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,d[1],c.i64.cast([0,0])).then(function(a){return a=a,d[2]=a[0],a})},function(b){return c.db.table(310).add({taskId:d[2],projectName:a[1],maxClientTokenPoolSize:a[0]})}])}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("XPlatReactVoprf",["asyncToGeneratorRuntime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("LSVoprfWasm").__setRef("XPlatReactVoprf"),i=null;function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(i==null){var a=(yield h.load());a=(yield a());var b=a.createCurveRistretto(),c=a.createVoprfExpTwohashdh(b);i={voprfInfo:{curvePtr:b,voprfPtr:c},voprfWasm:a}}return i});return j.apply(this,arguments)}g.loadXPlatReactVoprf=a}),98);
__d("LSVoprfBlind.nop",["XPlatReactVoprf","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=(yield d("XPlatReactVoprf").loadXPlatReactVoprf());b=a.voprfInfo;a=a.voprfWasm;a=a.blind(b,new Uint8Array(c));return[a.blindedElement.buffer,a.blindingFactor.buffer]});function c(b,c,d){return a.apply(this,arguments)}return c}();g["default"]=a}),98);
__d("LSVoprfCreateNonce.nop",["XPlatReactCrypto","XPlatReactVoprf","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("XPlatReactVoprf").loadXPlatReactVoprf());b=a.voprfInfo;a=a.voprfWasm;a=a.getCurveBytes(b);b=new Uint8Array(a);d("XPlatReactCrypto").getRandomValues(b);return[b.buffer]});function c(b,c){return a.apply(this,arguments)}return c}();g["default"]=a}),98);
__d("LSTaskSerializerAcsIssueNextSync",["LSBase64Encode.nop","LSGetCurrentTokenPoolState","LSIssueNextSync","LSVoprfBlind.nop","LSVoprfCreateNonce.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.db.table(310).fetch([[[a[0]]]]).next().then(function(a,e){var f=a.done;a=a.value;return f?(function(a){c.logger(a).mustfix(a)}("Request context for the passed task_id was not found"),f=[void 0,void 0],d[0]=f[0],d[1]=f[1],f):(e=a.item,c.sequence([function(a){return d[7]=e.projectName,d[8]=e.maxClientTokenPoolSize,c.storedProcedure(b("LSGetCurrentTokenPoolState"),d[7]).then(function(a){return a=a,d[3]=a[0],d[4]=a[1],a})},function(a){return c.i64.eq(d[3],c.i64.cast([0,0]))||c.i64.eq(d[3],c.i64.cast([0,1]))?c.resolve((d[9]=new c.Map(),d[9].set("project_name",d[7]),d[10]=c.toJSON(d[9]),a=[d[10],c.i64.cast([0,351])],d[5]=a[0],d[6]=a[1],a)):c.sequence([function(a){return d[9]=c.i64.of_float(Date.now()),c.islc(c.sortBy(c.filter(c.db.table(307).fetch(),function(a){return a.projectName===d[7]&&c.i64.gt(a.expirationTimestampMs,d[9])}),[["expirationTimestampMs","DESC"]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var a=e.done;e=e.value;return a?(function(a){c.logger(a).mustfix(a)}("A config for the passed project name was not found"),d[13]=new c.Map(),d[13].set("project_name",d[7]),d[13].set("max_client_token_pool_size",d[8]),d[14]=c.toJSON(d[13]),a=[d[14],c.i64.cast([0,362])],d[10]=a[0],d[11]=a[1],a):(f=e.item,c.sequence([function(a){return d[20]=f.configId,d[13]=f.maxEvals,d[22]=f.tokenPollFrequencyMs,d[21]=f.maxClientTokenPoolSize,d[14]=c.i64.sub(d[8],d[4]),d[19]=c.i64.lt(d[13],d[14])?d[13]:d[14],d[15]=c.createArray(),c.i64.gt(d[19],c.i64.cast([0,0]))?c.loopAsync(d[19],function(a){return d[23]=a,c.sequence([function(a){return c.nativeOperation(b("LSVoprfCreateNonce.nop")).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.blobs.neq(d[24],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSVoprfBlind.nop"),d[24]).then(function(a){return a=a,d[25]=a[0],d[26]=a[1],a})},function(a){return c.blobs.neq(d[25],void 0)?c.blobs.neq(d[26],void 0)?c.sequence([function(a){return d[27]=c.i64.cast([-1,4294967295]),c.db.table(308).peekNextAutoIncrementId().then(function(a){return d[27]=a})},function(a){return c.db.table(308).add({tokenId:void 0,blindedNonce:d[25],blindingFactor:d[26],nonce:d[24],configId:d[20]})},function(a){return c.db.table(308).fetch([[[d[27]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[28]=c.i64.cast([-1,4294967295]):(e=b.item,d[28]=e.tokenId)})},function(a){return c.i64.eq(d[28],c.i64.cast([-1,4294967295]))?c.sequence([function(a){return c.islc(c.db.table(308).fetchDesc([[[{gt:c.i64.cast([0,0])}]]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,e){var a=b.done;b=b.value;return a?d[33]=c.i64.cast([-1,4294967295]):(e=b.item,d[33]=e.tokenId)})},function(a){return d[30]=d[33]}]):c.resolve(d[30]=d[28])},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[25]).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[32]=new c.Map(),d[32].set("id",d[30]),d[32].set("data",d[31]==null?"":d[31]),d[33]=(d[15].push(d[32]),d[15])}]):c.resolve():c.resolve()}]):c.resolve()}])}):c.resolve()},function(a){return d[16]=c.i64.of_int32(d[15].length),c.i64.gt(d[16],c.i64.cast([0,0]))?c.resolve((d[23]=new c.Map(),d[23].set("project_name",d[7]),d[23].set("config_id",d[20]),d[23].set("blinded_nonces",d[15]),d[24]=c.toJSON(d[23]),a=[d[24],c.i64.cast([0,354])],d[17]=a[0],d[18]=a[1],a)):c.sequence([function(a){return c.i64.neq(d[22],void 0)?c.sequence([function(a){return c.i64.neq(d[21],void 0)?c.sequence([function(a){return function(a){c.logger(a).info(a)}(["Already have the max number of tokens. Scheduling next ACS token sync locally for project: ",d[7]].join("")),c.storedProcedure(b("LSIssueNextSync"),d[21],d[7],d[22],!1)},function(a){return a=[void 0,void 0],d[25]=a[0],d[26]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}(["token_poll_frequency is nonnull but max_client_token_pool_size is null. Already have the max number of tokens. Scheduling the next ACS token sync for project: ",d[7]].join("")),d[27]=new c.Map(),d[27].set("project_name",d[7]),d[27].set("max_client_token_pool_size",d[8]),d[28]=c.toJSON(d[27]),a=[d[28],c.i64.cast([0,362])],d[25]=a[0],d[26]=a[1],a))},function(a){return a=[d[25],d[26]],d[23]=a[0],d[24]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}(["Already have the max number of tokens. Scheduling the next ACS token sync for project: ",d[7]].join("")),d[25]=new c.Map(),d[25].set("project_name",d[7]),d[25].set("max_client_token_pool_size",d[8]),d[26]=c.toJSON(d[25]),a=[d[26],c.i64.cast([0,362])],d[23]=a[0],d[24]=a[1],a))},function(a){return a=[d[23],d[24]],d[17]=a[0],d[18]=a[1],a}])},function(a){return a=[d[17],d[18]],d[10]=a[0],d[11]=a[1],a}]))})},function(a){return a=[d[10],d[11]],d[5]=a[0],d[6]=a[1],a}])},function(a){return a=[d[5],d[6]],d[0]=a[0],d[1]=a[1],a}]))})},function(a){return a=[d[0],d[1]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSMailboxTaskCompletionApiOnTaskCompletion",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(233).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({success:a[1]})})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("ACSCipherSuiteModule",[],(function(a,b,c,d,e,f){"use strict";b={hash:"SHA-512",name:"HMAC"};c={curveName:"RISTRETTO",macAlgorithm:b,value:1};var g=new Map([[c.value,c]]);function a(a){return g.has(a)?g.get(a):null}f.VOPRF_RISTRETTO_HMACSHA512=c;f.getACSCipherSuiteByValue=a}),66);
__d("ACSTokenHmacUtil",["XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return h(a,b).then(function(a){return j(a,c)})}function h(a,b){return d("XPlatReactCrypto").subtleImportKey("raw",b,a,!1,["sign"]).then(function(b){return{algo:a,key:b}})}function i(a){return typeof a.hash==="string"?a.hash:a.hash.name}function j(a,b){var c=a.algo;a=a.key;c={hash:i(c),name:"HMAC"};return d("XPlatReactCrypto").subtleSign(c,a,b).then(function(a){return new Uint8Array(a)})}g.hmac=a}),98);
__d("LSVoprfHmac.nop",["ACSCipherSuiteModule","ACSTokenHmacUtil","Promise","XPlatReactTextEncoder","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){a=d("ACSCipherSuiteModule").getACSCipherSuiteByValue(d("ACSCipherSuiteModule").VOPRF_RISTRETTO_HMACSHA512.value);if(!a)return(h||(h=b("Promise"))).resolve([void 0]);c=(yield d("ACSTokenHmacUtil").hmac(a.macAlgorithm,new Uint8Array(f).slice(),new(d("XPlatReactTextEncoder").TextEncoder)().encode(e)));return(h||(h=b("Promise"))).resolve([c.buffer])});function c(b,c,d,e){return a.apply(this,arguments)}return c}();g["default"]=a}),98);
__d("LSTaskSerializerUnauthenticatedTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSMailboxTaskCompletionApiOnTaskCompletion","LSRemoveUsedTokens","LSVoprfHmac.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return a[1]!==void 0?c.sequence([function(b){return c.db.table(311).fetch([[[a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[2]="":(b=a.item,d[2]=b.projectName)})},function(a){return d[4]=c.createArray(),d[5]=c.i64.of_float(Date.now()),c.forEach(c.filter(c.db.table(307).fetch(),function(a){return d[2]===a.projectName&&c.i64.gt(a.expirationTimestampMs,d[5])}),function(a){a=a.item;return d[10]=(d[4].push(a.configId),d[4])})},function(a){return c.sequence([function(a){return d[10]=c.createArray(),d[11]=c.i64.of_int32(d[4].length),c.i64.gt(d[11],c.i64.cast([0,0]))?c.loopAsync(d[11],function(a){return d[13]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[4],d[13]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(a){return d[16]=(d[10].push(d[14]),d[10])}])}):c.resolve()},function(a){return d[12]=d[10].join(","),d[6]=d[12]}])},function(e){return c.filter(c.db.table(309).fetch(),function(a){return d[4].includes(a.configId)&&c.i64.gt(a.redeemLimit,c.i64.cast([0,0]))}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[10]=c.createArray(),d[11]=(d[10].push("Unauthenticated Task Serializer: no valid tokens"),d[10]),d[12]=(d[10].push(a[0]),d[10]),d[13]=(d[10].push(d[2]),d[10]),d[14]=c.toJSON(d[10]),function(a){c.logger(a).mustfix(a)}(d[14]),b=[void 0,void 0],d[7]=b[0],d[8]=b[1],b}]):(f=e.item,c.sequence([function(e){return d[13]=f.tokenId,c.nativeOperation(b("LSVoprfHmac.nop"),a[2]==null?"":a[2],f.sharedSecret).then(function(a){return a=a,d[10]=a[0],a})},function(e){return c.blobs.neq(d[10],void 0)?c.sequence([function(a){return c.forEach(c.db.table(309).fetch([[[d[13]]]]),function(a){var b=a.update;a=a.item;return b({redeemLimit:c.i64.sub(a.redeemLimit,c.i64.cast([0,1]))})})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[10]).then(function(a){return a=a,d[14]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),f.nonce).then(function(a){return a=a,d[15]=a[0],a})},function(b){return d[16]=new c.Map(),d[16].set("config_id",f.configId),d[16].set("tag",d[14]==null?"":d[14]),d[16].set("aux",d[15]==null?"":d[15]),d[16].set("project_name",d[2]),d[17]=c.toJSON(d[16]),d[18]=new c.Map(),d[18].set("payload",a[2]==null?"":a[2]),d[18].set("token",d[17]),d[19]=c.toJSON(d[18]),b=[d[19],c.i64.from_string(a[1])],d[11]=b[0],d[12]=b[1],b}]):c.sequence([function(a){return c.forEach(c.db.table(309).fetch([[[d[13]]]]),function(a){return a["delete"]()})},function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[14]=c.createArray(),d[15]=(d[14].push("Unauthenticated Task Serializer: hmac failed"),d[14]),d[16]=(d[14].push(a[0]),d[14]),d[17]=c.toJSON(d[14]),function(a){c.logger(a).mustfix(a)}(d[17]),b=[void 0,void 0],d[11]=b[0],d[12]=b[1],b}])},function(a){return a=[d[11],d[12]],d[7]=a[0],d[8]=a[1],a}]))})},function(a){return a=[d[7],d[8]],d[0]=a[0],d[1]=a[1],a}]):c.sequence([function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[2]=c.createArray(),d[3]=(d[2].push("Unauthenticated Task Serializer: task has no write label"),d[2]),d[4]=(d[2].push(a[0]),d[2]),d[5]=c.toJSON(d[2]),function(a){c.logger(a).mustfix(a)}(d[5]),b=[void 0,void 0],d[0]=b[0],d[1]=b[1],b}])},function(a){return c.storedProcedure(b("LSRemoveUsedTokens"))},function(a){return a=[d[0],d[1]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSTaskSerializerE2eeMessageIntegrityCheckV2",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,c.i64.cast([0,705])],d[0]=a[0],d[1]=a[1],a,c.resolve(d)}e.exports=a}),null);
__d("LSTaskSerializerE2eeMetadataThreadIntegrityCheck",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,c.i64.cast([0,700])],d[0]=a[0],d[1]=a[1],a,c.resolve(d)}e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupAction",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,c.i64.cast([0,319])],d[0]=a[0],d[1]=a[1],a,c.resolve(d)}e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsLoopingUpload",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsLoopingUpload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure] LSEncryptedBackupsLoopingUploadPayloadsTable table not found"),d[2]=c.createArray(),void 0!==void 0?d[9]=(d[2].push(void 0),d[2]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure","LSEncryptedBackupsLoopingUploadPayloadsTable table not found",d[2],c.i64.cast([0,3]))},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsLoopingUpload] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsLoopingUpload",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()},function(a){return a=['{"request_id":"unknown","upload_type":"FBN","payload":{"error_code":2,"operation":"","error_message":"","__typename":"MPSUploadFailurePayload"}}',c.i64.cast([0,50043])],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSGetOpenEpochKeys",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSCreateDataTrace","LSCreateDataTraceID.nop","LSDeleteBackupOnClient","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Beginning execution."),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))&&c.i64.eq(a.backupTenancy,c.i64.cast([0,2]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?d[1]=!1:(a.item,d[1]=!0)})},function(a){return d[1]?d[3]=c.i64.or_(c.i64.cast([0,90]),c.i64.cast([0,128])):d[3]=c.i64.cast([0,90]),c.nativeOperation(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[22]="EncryptedBackups MCD Trace ID",d[23]=c.i64.to_string(d[3]),d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",d[5],d[22],d[5],d[23]].join("")),c.resolve()},function(a){return c.storedProcedure(b("LSCreateDataTrace"),d[4],void 0,void 0,"get_open_epoch_keys",d[3])},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[6]=a[0],a})},function(a){return d[6]?d[7]=!0:d[7]=!1,d[7]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[29],c.i64.cast([0,3]))):c.resolve()},function(b){return d[24]="Querying latest epoch keys with authority level: ",a[0]?d[8]="OPTIMISTIC":d[8]="AUTHORITATIVE",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",d[9],d[24],d[9],d[8]].join("")),c.resolve()},function(e){return a[0]?d[10]="OPTIMISTIC":d[10]="AUTHORITATIVE",d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2842]),c.i64.cast([0,2]),void 0,d[10]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]?d[12]=!0:d[12]=!1,d[12]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[29],c.i64.cast([0,3]))):c.resolve()},function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2844]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[29],c.i64.cast([0,3]))):c.resolve()},function(b){return d[15]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(b){return a[0]||c.i64.eq(b.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[29]=(d[15].push(c.blobs.to_string(a.epochAnonIdBlob)),d[15])})},function(a){return d[16]=c.i64.of_int32(d[15].length),c.i64.gt(d[16],c.i64.cast([0,0]))?c.sequence([function(a){return d[29]=c.i64.of_int32(d[15].length),d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2845]),c.i64.cast([0,2]),void 0,c.i64.to_string(d[29])):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!0:d[31]=!1,d[31]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[36]=c.createArray(),void 0!==void 0?d[37]=(d[36].push(void 0),d[36]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[36],c.i64.cast([0,3]))):c.resolve()},function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[15],c.i64.cast([0,0])).then(function(a){return a=a,d[32]=a[0],d[33]=a[1],a})},function(a){return d[34]=d[32],d[35]=c.i64.of_int32(d[15].length),c.i64.gt(d[35],c.i64.cast([0,0]))?c.loopAsync(d[35],function(a){return d[36]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[15],d[36]).then(function(a){return a=a,d[37]=a[0],d[38]=a[1],a})},function(a){return c.i64.eq([0,d[34].length],[0,d[37].length])?(d[34]===d[37]?d[40]=d[34]:(d[34]>d[37]?d[41]=d[34]:d[41]=d[37],d[40]=d[41]),d[39]=d[40]):(c.i64.gt([0,d[34].length],[0,d[37].length])?d[40]=d[34]:d[40]=d[37],d[39]=d[40]),d[34]=d[39]}])}):c.resolve()},function(a){return d[17]=d[34]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Epoch anon ID list is empty."),d[29]=c.createArray(),void 0!==void 0?d[32]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure","Epoch anon ID list is empty.",d[29],c.i64.cast([0,3]))},function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2846]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!0:d[31]=!1,d[31]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),void 0!==void 0?d[33]=(d[32].push(void 0),d[32]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()},function(a){return d[17]=void 0}])},function(a){return d[17]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2863]),c.i64.cast([0,2]),void 0,d[17]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!0:d[30]=!1,d[30]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[31]=c.createArray(),void 0!==void 0?d[32]=(d[31].push(void 0),d[31]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[31],c.i64.cast([0,3]))):c.resolve()}]):c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2864]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!0:d[30]=!1,d[30]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[31]=c.createArray(),void 0!==void 0?d[32]=(d[31].push(void 0),d[31]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[31],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[25]=c.blobs.of_string(d[17]),c.blobs.neq(d[25],void 0)?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2847]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!0:d[30]=!1,d[30]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[33]=c.createArray(),void 0!==void 0?d[34]=(d[33].push(void 0),d[33]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[33],c.i64.cast([0,3]))):c.resolve()},function(a){return c.filter(c.db.table(169).fetch(),function(a){return c.blobs.eq(a.epochAnonIdBlob,d[25])}).next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Found a most recent epoch anon ID, but unable to locate it again in the table. This can really only happen if the tablesomehow changed in the middle of our transaction."),d[33]=c.createArray(),void 0!==void 0?d[36]=(d[33].push(void 0),d[33]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure","Found a most recent epoch anon ID, but unable to locate it again in the table. This can really only happen if the tablesomehow changed in the middle of our transaction.",d[33],c.i64.cast([0,3]))},function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2848]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[35]=!0:d[35]=!1,d[35]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[36]=c.createArray(),void 0!==void 0?d[37]=(d[36].push(void 0),d[36]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[36],c.i64.cast([0,3]))):c.resolve()},function(a){return d[31]=void 0}]):(e=a.item,c.sequence([function(a){return d[37]=e.epochAnonIdBlob,d[35]="Using latest epoch: ",d[36]=c.blobs.to_string(d[37]),d[33]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",d[33],d[35],d[33],d[36]].join("")),c.resolve()},function(a){return d[34]=new c.Map(),d[34].set("epoch_id",e.epochId),d[34].set("epoch_root_key",e.epochRootKeyBlob),d[34].set("epoch_anon_id",d[37]),d[31]=d[34]}]))})},function(a){return d[18]=d[31]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] No epochs whatsoever on client! This should absolutely never happen. Deleting backup from client."),d[29]=c.createArray(),void 0!==void 0?d[32]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure","No epochs whatsoever on client! This should absolutely never happen. Deleting backup from client.",d[29],c.i64.cast([0,3]))},function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2843]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!0:d[31]=!1,d[31]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),void 0!==void 0?d[33]=(d[32].push(void 0),d[32]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),void 0,"get_open_epoch_keys",!0,d[4],"Attempted to fetch epoch keys when there are no epochs on the client.",!1)},function(a){return d[18]=void 0}])},function(a){return d[19]=c.i64.of_float(Date.now()),d[20]=c.i64.random(),d[26]="Finishing execution. Execution time: ",d[27]=c.i64.to_string(c.i64.sub(d[19],d[0])),d[28]=" ms",d[21]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",d[21],d[26],d[21],d[27],d[21],d[28]].join("")),c.i64.eq(c.i64.mod_(d[20],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[29]=",",d[30]=c.createArray(),void 0!==void 0?d[31]=(d[30].push(void 0),d[30]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",[d[26],d[29],d[27],d[29],d[28]].join(""),d[30],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[18]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsRestoreWithSerializer",["LSAppendDataTraceAddon","LSBase64Encode.nop","LSGetOpenEpochKeys","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure] Beginning execution."),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure] Fetching locally available epochs on client from epochs table"),d[1]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[15]=(d[1].push(a.epochId),d[1])})},function(a){return d[10]="Queried locally available epochs. Count: ",d[2]=c.i64.of_int32(d[1].length),d[11]=c.i64.to_string(d[2]),d[3]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[3],d[10],d[3],d[11]].join("")),c.resolve()},function(e){return c.db.table(168).fetch().next().then(function(e,f){var g=e.done;e=e.value;return g?(g=[void 0,void 0],d[4]=g[0],d[5]=g[1],g):(f=e.item,c.sequence([function(e){return d[17]=f.deviceId,c.i64.neq(d[17],void 0)?c.sequence([function(e){return c.db.table(190).fetch([[[a[0]]]]).next().then(function(e,h){var a=e.done;e=e.value;return a?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure] No restore payload context found."),d[21]=c.createArray(),void 0!==void 0?d[22]=(d[21].push(void 0),d[21]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure","No restore payload context found.",d[21],c.i64.cast([0,3]))},function(a){return a=[void 0,void 0],d[18]=a[0],d[19]=a[1],a}]):(h=e.item,c.sequence([function(a){return d[31]=h.traceId,d[31]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[31],c.i64.cast([0,3603]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[22]=!0:d[22]=!1,d[22]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),void 0!==void 0?d[33]=(d[32].push(void 0),d[32]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()},function(a){return d[23]=new c.Map(),d[23].set("server_thread_key",h.serverThreadKey),d[23].set("otid",h.messageId),d[23].set("timestamp",h.unencryptedSortKey),d[23].set("wa_thread_id",h.waThreadId),c.nativeOperation(b("LSBase64Encode.nop"),f.ocmfClientStateBlob).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),f.mailboxRootKeyBlob).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[26]=new c.Map(),d[26].set("ocmf_client_state_blob",d[24]==null?"":d[24]),d[26].set("mailbox_root_key",d[25]==null?"":d[25]),c.storedProcedure(b("LSGetOpenEpochKeys"),!1).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]!==void 0?(d[32]=d[27].get("epoch_id"),d[27],d[28]=d[32]):d[28]=void 0,d[29]=new c.Map(),d[29].set("content_type",h.contentType),d[29].set("device_id",d[17]),d[29].set("epoch_id",d[28]),d[29].set("list_id",h.listId),d[29].set("num_items",h.numItems),d[29].set("start_sort_key",h.startSortKey),d[29].set("mailbox_partial_id",h.mailboxPartialId),d[29].set("trace_id",d[31]),d[29].set("message_partial_id",h.messagePartialId),d[29].set("newer_num_items",h.newerNumItems),d[29].set("locally_available_epochs",d[1]),d[29].set("raw_identifiers",d[23]),d[29].set("raw_tokens",d[26]),d[30]=c.toJSON(d[29]),a=[d[30],c.i64.cast([0,50015])],d[18]=a[0],d[19]=a[1],a}]))})},function(a){return a=[d[18],d[19]],d[15]=a[0],d[16]=a[1],a}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure] Unexpected error: Device ID is null."),d[18]=c.createArray(),void 0!==void 0?d[19]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure","Unexpected error: Device ID is null.",d[18],c.i64.cast([0,3]))},function(a){return a=[void 0,void 0],d[15]=a[0],d[16]=a[1],a}])},function(a){return a=[d[15],d[16]],d[4]=a[0],d[5]=a[1],a}]))})},function(a){return d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[14]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure] ",d[9],d[12],d[9],d[13],d[9],d[14]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[4],d[5]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSEncryptIdentifiers",["LSBase64Encode.nop","LSBinaryToHex.nop","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][encryptIdentifiers] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=a[2].get("backup_id"),a[2],d[3]=a[3].get("ocmf_shared_key"),a[3],c.nativeOperation(b("LSGetBlobFromString.nop"),d[2]).then(function(a){return a=a,d[4]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[4]).then(function(a){return a=a,d[5]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[3],d[5]).then(function(a){return a=a,d[6]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[6]).then(function(a){return a=a,d[7]=a[0],a})},function(e){return c.i64.eq(a[0],c.i64.cast([0,2]))&&c.i64.eq(a[1],c.i64.cast([0,2]))?(d[33]=a[2].get("otid"),a[2],d[8]=d[33]):(d[33]=a[2].get("act_thread_id"),a[2],d[8]=d[33]),d[9]=a[3].get("ocmf_shared_key"),a[3],c.nativeOperation(b("LSGetBlobFromString.nop"),d[8]).then(function(a){return a=a,d[10]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[10]).then(function(a){return a=a,d[11]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[9],d[11]).then(function(a){return a=a,d[12]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[12]).then(function(a){return a=a,d[13]=a[0],a})},function(e){return d[14]=a[3].get("ope_key"),a[3],d[15]=a[2].get("timestamp"),a[2],c.nativeOperation(b("LSGetBlobFromInt64BE.nop"),c.i64.from_string(d[15])).then(function(a){return a=a,d[16]=a[0],a})},function(a){return c.nativeOperation(b("LSTruncateSortKey.nop"),d[16]).then(function(a){return a=a,d[17]=a[0],a})},function(a){return c.nativeOperation(b("LSOpeEncrypt.nop"),d[14],d[17],c.i64.cast([0,16])).then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.nativeOperation(b("LSBinaryToHex.nop"),d[18]).then(function(a){return a=a,d[19]=a[0],a})},function(e){return d[20]=a[2].get("otid"),a[2],d[21]=a[3].get("ocmf_shared_key"),a[3],c.nativeOperation(b("LSGetBlobFromString.nop"),d[20]).then(function(a){return a=a,d[22]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[22]).then(function(a){return a=a,d[23]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[21],d[23]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[24]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[26]=new c.Map(),d[26].set("backup_id_ocmf_partial",d[7]==null?"":d[7]),d[26].set("act_thread_id_ocmf_partial",d[13]==null?"":d[13]),d[26].set("timestamp_encrypted",d[19]==null?"":d[19]),d[26].set("otid_ocmf_partial",d[25]==null?"":d[25]),d[27]=c.i64.of_float(Date.now()),d[28]=c.i64.random(),d[30]="Finishing execution. Execution time: ",d[31]=c.i64.to_string(c.i64.sub(d[27],d[0])),d[32]=" ms",d[29]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][encryptIdentifiers] ",d[29],d[30],d[29],d[31],d[29],d[32]].join("")),c.i64.eq(c.i64.mod_(d[28],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[33]=",",d[34]=c.createArray(),void 0!==void 0?d[35]=(d[34].push(void 0),d[34]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"encryptIdentifiers",[d[30],d[33],d[31],d[33],d[32]].join(""),d[34],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[26],void 0],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("EncryptedBackupsSymmetricEncryptionUtils",[],(function(a,b,c,d,e,f){"use strict";a=16;b=28;c=16;d=128;f.hChaCha20SubKeyNonceLengthInBytes=a;f.totalNonceLengthInBytes=b;f.aesGcmTagLengthInBytes=c;f.aesGcmTagLength=d}),66);
__d("HChaCha20",["err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){}a.fromHexString=function(a){var b=a.match(/[A-Fa-f0-9]{1,2}/g);if(a.length===0||a.length%2!==0||b==null)throw c("err")('The string "'+a+'" is not valid hex.');return new Uint8Array(b.map(function(a){return parseInt(a,16)}))};a.bufferToUint32Array=function(a){var b=new DataView(a),c=[];a=a.byteLength/4;for(var d=0;d<a;d++)c.push(new DataView(b.buffer.slice(d*4,d*4+4)).getInt32(0));return Uint32Array.from(c)};a.rotate=function(a,b){a=a&4294967295;b=b&31;return(a<<b|a>>>32-b)>>>0};a.quarterRound=function(b,c,d,e){b=b;c=c;d=d;e=e;b=b+c&4294967295;e=a.rotate(e^b,16);d=d+e&4294967295;c=a.rotate(c^d,12);b=b+c&4294967295;e=a.rotate(e^b,8);d=d+e&4294967295;c=a.rotate(c^d,7);return[b>>>0,c>>>0,d>>>0,e>>>0]};var b=a.prototype;b.createHCtx=function(b,d){var e=new Uint32Array(16),f=a.fromHexString("657870616e642033322d62797465206b");if(f.byteLength!==16)throw c("err")("Could not create context. Invalid constant buffer length of "+f.byteLength+". Expected a length of 16");else if(b.byteLength!==32)throw c("err")("Could not create context. Invalid key buffer length of "+b.byteLength+". Expected a length of 32");else if(d.byteLength!==16)throw c("err")("Could not create context. Invalid nonce buffer length of "+d.byteLength+". Expected a length of 16");f=a.bufferToUint32Array(f.buffer);b=a.bufferToUint32Array(b);d=a.bufferToUint32Array(d);e.set(f);e.set(b,f.length);e.set(d,f.length+b.length);return e.buffer};b.hChaCha20Bytes=function(b,c){c=new DataView(this.createHCtx(c,b));b=c.getInt32(0);var d=c.getInt32(1<<2),e=c.getInt32(2<<2),f=c.getInt32(3<<2),g=c.getInt32(4<<2),h=c.getInt32(5<<2),i=c.getInt32(6<<2),j=c.getInt32(7<<2),k=c.getInt32(8<<2),l=c.getInt32(9<<2),m=c.getInt32(10<<2),n=c.getInt32(11<<2),o=c.getInt32(12<<2),p=c.getInt32(13<<2),q=c.getInt32(14<<2);c=c.getInt32(15<<2);for(var r=0;r<10;r++){var s=a.quarterRound(b,g,k,o);b=s[0];g=s[1];k=s[2];o=s[3];s=a.quarterRound(d,h,l,p);d=s[0];h=s[1];l=s[2];p=s[3];s=a.quarterRound(e,i,m,q);e=s[0];i=s[1];m=s[2];q=s[3];s=a.quarterRound(f,j,n,c);f=s[0];j=s[1];n=s[2];c=s[3];s=a.quarterRound(b,h,m,c);b=s[0];h=s[1];m=s[2];c=s[3];s=a.quarterRound(d,i,n,o);d=s[0];i=s[1];n=s[2];o=s[3];s=a.quarterRound(e,j,k,p);e=s[0];j=s[1];k=s[2];p=s[3];s=a.quarterRound(f,g,l,q);f=s[0];g=s[1];l=s[2];q=s[3]}return Uint32Array.from([b,d,e,f,o,p,q,c]).buffer};return a}();g.HChaCha20=a}),98);
__d("SymmetricEncryptionPaddingUtils",["XPlatReactTextEncoder"],(function(a,b,c,d,e,f,g){"use strict";function h(a){if(a<10)return 10-a;var b=Math.floor(Math.log2(a)),c=Math.floor(Math.log2(b))+1;b=b-c;c=(1<<b)-1;b=a+c&(c^-1);return b-a}function i(a){var b=Uint32Array.BYTES_PER_ELEMENT,c=a.byteLength,d=h(c);d=b+c+d;d=new DataView(new ArrayBuffer(d));d.setUint32(0,c);c=new Uint8Array(d.buffer);c.set(new Uint8Array(a),b);return c.buffer}function a(a){var b=new(d("XPlatReactTextEncoder").TextEncoder)();b=b.encode(a).buffer;return i(b)}function b(a){var b=Uint32Array.BYTES_PER_ELEMENT,c=new DataView(a);if(c.byteLength<b)return;var d=a.byteLength;c=c.getUint32(0);d=d-b;if(c>=0&&c<=d)return a.slice(b,b+c)}g.getPaddingLength=h;g.padData=i;g.pad=a;g.stripPadding=b}),98);
__d("LSSymmetricEncryptionCreateEncryptedData.nop",["CryptoLogger","EncryptedBackupsSymmetricEncryptionUtils","HChaCha20","Promise","RetUtil","SymmetricEncryptionPaddingUtils","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,c,e,f,g){var i=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_encrypted_data"),j=d("SymmetricEncryptionPaddingUtils").padData(g),k=d("XPlatReactCrypto").getRandomValues(new Uint8Array(d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes));a=new(d("HChaCha20").HChaCha20)();c=a.hChaCha20Bytes(k.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer,e);return d("XPlatReactCrypto").subtleImportKey("raw",c,"AES-GCM",!1,["encrypt"]).then(function(a){return d("XPlatReactCrypto").subtleEncrypt({additionalData:f,iv:new Uint8Array(k.slice(d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer),name:"AES-GCM",tagLength:d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLength},a,j)}).then(function(a){var c=k.byteLength+a.byteLength;c=new Uint8Array(c);c.set(k);c.set(new Uint8Array(a),d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes);return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(c.buffer))})["catch"](function(a){d("CryptoLogger").captureError(i,a).mustfix("symmetric data encryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})};g["default"]=a}),98);
__d("LSSymmetricEncryptionCreateEncryptedString.nop",["Base64Utils","CryptoLogger","LSCryptoUtils","LSSymmetricEncryptionCreateEncryptedData.nop","Promise","RetUtil"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f,g,i){var j=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_encrypted_string");return c("LSSymmetricEncryptionCreateEncryptedData.nop")(a,e,f,g,d("LSCryptoUtils").strToBuf(i)).then(function(a){return a[0]}).then(function(a){return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(a?d("Base64Utils").fromArrayBuffer(a):void 0))})["catch"](function(a){d("CryptoLogger").captureError(j,a).mustfix("symmetric string encryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})};g["default"]=a}),98);
__d("LSEncryptMessagePayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][encryptMessagePayload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=a[1].get("message_payload_encryption_keys"),a[1],d[3]=d[2].get("payload_key"),d[2],d[4]=a[0].get("act_thread_id"),a[0],c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[3],c.blobs.of_string(["message_thread","_",d[4]].join("")),a[2]).then(function(a){return a=a,d[5]=a[0],a})},function(e){return d[5]!==void 0?c.sequence([function(e){return d[14]=d[2].get("encryption_version"),d[2],d[15]=d[2].get("epoch_anon_id"),d[2],d[16]=d[2].get("epoch_root_key"),d[2],d[17]=a[0].get("act_thread_id"),a[0],d[18]=d[2].get("payload_key"),d[2],d[19]=a[0].get("backup_id"),a[0],d[20]=d[2].get("payload_fallback_key"),d[2],d[21]=c.createArray(),d[51]=(d[21].push(c.i64.cast([0,6])),d[21]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_anon_id_debug").then(function(a){return a=a,d[22]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[22],void 0,d[15],d[21]).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]?d[24]=!1:d[24]=!0,d[24]?c.resolve(d[25]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[23],c.i64.cast([0,0])).then(function(a){return a=a,d[51]=a[0],d[52]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[51]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[25]=d[53]==null?"":d[53]}])},function(a){return d[26]=c.createArray(),d[51]=(d[26].push(c.i64.cast([0,6])),d[26]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_debug").then(function(a){return a=a,d[27]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[27],void 0,d[16],d[26]).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!1:d[29]=!0,d[29]?c.resolve(d[30]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[28],c.i64.cast([0,0])).then(function(a){return a=a,d[51]=a[0],d[52]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[51]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[30]=d[53]==null?"":d[53]}])},function(a){return d[31]=c.createArray(),d[51]=(d[31].push(c.i64.cast([0,6])),d[31]),c.nativeOperation(b("LSGetBlobFromString.nop"),"message_key_debug").then(function(a){return a=a,d[32]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[32],void 0,d[18],d[31]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[33]?d[34]=!1:d[34]=!0,d[34]?c.resolve(d[35]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[33],c.i64.cast([0,0])).then(function(a){return a=a,d[51]=a[0],d[52]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[51]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[35]=d[53]==null?"":d[53]}])},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[16]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),[d[36]==null?"":d[36],d[17]].join("")).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[38]=c.createArray(),d[51]=(d[38].push(c.i64.cast([0,6])),d[38]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_thread_id_debug").then(function(a){return a=a,d[39]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[39],void 0,d[37],d[38]).then(function(a){return a=a,d[40]=a[0],a})},function(a){return d[40]?d[41]=!1:d[41]=!0,d[41]?c.resolve(d[42]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[40],c.i64.cast([0,0])).then(function(a){return a=a,d[51]=a[0],d[52]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[51]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[42]=d[53]==null?"":d[53]}])},function(a){return d[43]=":",d[50]=[d[25],d[43],d[30],d[43],d[35],d[43],d[42]].join(""),c.blobs.neq(d[16],void 0)?c.sequence([function(a){return d[51]=c.createArray(),d[57]=(d[51].push(c.i64.cast([0,18])),d[51]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[16],d[51]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return d[52]!==void 0?c.sequence([function(a){return d[57]=c.i64.of_int32(d[52].length),c.i64.ge(d[57],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[52],c.i64.cast([0,0])).then(function(a){return a=a,d[59]=a[0],d[60]=a[1],a})},function(a){return d[58]=d[59]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[59]=c.createArray(),void 0!==void 0?d[60]=(d[59].push(void 0),d[59]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[59],c.i64.cast([0,3]))},function(a){return d[58]=void 0}])},function(a){return d[53]=d[58]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[57]=c.createArray(),void 0!==void 0?d[58]=(d[57].push(void 0),d[57]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[57],c.i64.cast([0,3]))},function(a){return d[53]=void 0}])},function(a){return c.blobs.neq(d[53],void 0)?d[54]=!0:d[54]=!1,d[54]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[53]).then(function(a){return a=a,d[55]=a[0],a})},function(a){return d[55]!==void 0?d[56]=d[55]:d[56]="encodingfailed",d[44]=d[56]}]):c.resolve(d[44]="null")},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[15]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[49]=d[45]==null?"":d[45],c.blobs.neq(d[20],void 0)?c.sequence([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][MEBSerializationUtils] Including fallback encrypted epoch key in value_secret_ref."),c.nativeOperation(b("LSBase64Encode.nop"),d[16]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[20],c.blob("ZmFsbGJhY2tfZW5jcnlwdGVkX2Vwb2NoX2tleQ=="),d[51]==null?"":d[51]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return d[52]!==void 0?d[53]=d[52]:d[53]="",d[54]=new c.Map(),d[54].set("encryption_version",d[14]),d[54].set("epoch_anon_id",d[49]),d[54].set("message_encryption_values",d[50]),d[54].set("fallback_encrypted_epoch_key",d[53]),d[54].set("root_key_fingerprint",d[44]),d[54].set("backup_id",d[19]),d[46]=d[54]}]):c.resolve((d[51]=new c.Map(),d[51].set("encryption_version",d[14]),d[51].set("epoch_anon_id",d[49]),d[51].set("message_encryption_values",d[50]),d[51].set("root_key_fingerprint",d[44]),d[51].set("backup_id",d[19]),d[46]=d[51]))},function(a){return d[47]=c.toJSON(d[46]),d[48]=new c.Map(),d[48].set("encrypted_message_payload",d[5]),d[48].set("value_secret_ref",d[47]),a=[d[48],void 0],d[6]=a[0],d[7]=a[1],a}]):c.resolve((d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,40])),d[14].set("stored_procedure","LSEncryptedBackupsEncryptMessagePayloadStoredProcedure"),d[14].set("error_message",""),e=[void 0,d[14]],d[6]=e[0],d[7]=e[1],e))},function(a){return d[8]=c.i64.of_float(Date.now()),d[9]=c.i64.random(),d[11]="Finishing execution. Execution time: ",d[12]=c.i64.to_string(c.i64.sub(d[8],d[0])),d[13]=" ms",d[10]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][encryptMessagePayload] ",d[10],d[11],d[10],d[12],d[10],d[13]].join("")),c.i64.eq(c.i64.mod_(d[9],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[14]=",",d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"encryptMessagePayload",[d[11],d[14],d[12],d[14],d[13]].join(""),d[15],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[6],d[7]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSGetLatestEpochKeys",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][getLatestEpochKeys] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]="",d[3]=void 0,d[4]=void 0,a[0]?c.resolve(0):c.i64.neq(void 0,void 0)?c.db.table(169).fetch([[[void 0]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?0:(b=a.item,d[2]=c.blobs.to_string(b.epochAnonIdBlob),d[3]=b.epochId,d[4]=b.epochRootKeyBlob)}):c.resolve()},function(b){return c.i64.neq(d[3],void 0)?c.resolve(0):c.forEach(c.filter(c.db.table(169).fetch(),function(b){return a[0]||c.i64.eq(b.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[15]=c.blobs.to_string(a.epochAnonIdBlob),c.i64.eq([0,d[15].length],[0,d[2].length])?d[14]=d[15]>d[2]:d[14]=c.i64.gt([0,d[15].length],[0,d[2].length]),d[14]?(d[2]=d[15],d[3]=a.epochId,d[4]=a.epochRootKeyBlob):0})},function(a){return d[10]=c.blobs.of_string(d[2]),c.i64.neq(d[3],void 0)?(c.blobs.neq(d[10],void 0)?(c.blobs.neq(d[4],void 0)?(d[18]=new c.Map(),d[18].set("epoch_id",d[3]),d[18].set("epoch_root_key",d[4]),d[18].set("epoch_anon_id",d[10]),d[19]=new c.Map(),d[19].set("epoch_keys",d[18]),a=[d[19],void 0],d[16]=a[0],d[17]=a[1],a):(d[18]=new c.Map(),d[18].set("error_code",c.i64.cast([0,402])),d[18].set("error_message","failed to query latest epoch"),d[18].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[void 0,d[18]],d[16]=a[0],d[17]=a[1],a),a=[d[16],d[17]],d[14]=a[0],d[15]=a[1],a):(d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,403])),d[16].set("error_message","failed to query latest epoch"),d[16].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[void 0,d[16]],d[14]=a[0],d[15]=a[1],a),a=[d[14],d[15]],d[5]=a[0],d[6]=a[1],a):(d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,400])),d[14].set("error_message","failed to query latest epoch"),d[14].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[void 0,d[14]],d[5]=a[0],d[6]=a[1],a),d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[11]="Finishing execution. Execution time: ",d[12]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[13]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][getLatestEpochKeys] ",d[9],d[11],d[9],d[12],d[9],d[13]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[14]=",",d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"getLatestEpochKeys",[d[11],d[14],d[12],d[14],d[13]].join(""),d[15],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSLoadAndEncryptProtobufWithInputs",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateEncryptedData.nop","gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][loadAndEncryptProtobufWithInputs] Beginning execution."),e[1]=d.i64.of_float(Date.now()),(c("gkx")("7350")||c("gkx")("4765"))&&c("gkx")("7298")?d.sequence([function(c){return d.i64.eq(a[0],d.i64.cast([0,1]))?d.sequence([function(c){return d.filter(d.db.table(301).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}).next().then(function(c,f){var g=c.done;c=c.value;return g?(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),e[15]=new d.Map(),e[15].set("error_code",d.i64.cast([0,63])),e[15].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure"),e[15].set("error_message",""),g=[void 0,e[15]],e[12]=g[0],e[13]=g[1],g):(f=c.item,d.sequence([function(b){return e[15]=d.createArray(),d.forEach(d.filter(d.db.table(304).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}),function(a){a=a.item;return e[23]=(e[15].push(a.tag),e[15])})},function(c){return e[16]=a[5].get("message_payload_encryption_keys"),a[5],e[17]=e[16].get("payload_key"),e[16],e[18]=a[6].get("act_thread_id"),a[6],d.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),e[17],d.blobs.of_string(["message_thread","_",e[18]].join("")),f.messagePayload).then(function(a){return a=a,e[19]=a[0],a})},function(a){return d.blobs.neq(e[19],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[19]).then(function(a){return a=a,e[23]=a[0],a})},function(a){return e[20]=e[23]}]):d.resolve(e[20]=void 0)},function(b){return e[20]!==void 0?(e[15]!==void 0?(e[25]=new d.Map(),e[25].set("message_tags",e[15]),e[26]=d.toJSON(e[25]),e[23]=e[26]):e[23]=void 0,e[24]=new d.Map(),e[24].set("backup_action",a[0]),e[24].set("protobuf_encrypted",e[20]),e[24].set("supplemental_data_encrypted",void 0),e[24].set("timestamp_ms",a[4]),e[24].set("message_tags",e[23]),b=[e[24],void 0],e[21]=b[0],e[22]=b[1],b):(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),e[23]=new d.Map(),e[23].set("error_code",d.i64.cast([0,62])),e[23].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure"),e[23].set("error_message",""),b=[void 0,e[23]],e[21]=b[0],e[22]=b[1],b),b=[e[21],e[22]],e[12]=b[0],e[13]=b[1],b}]))})},function(a){return a=[e[12],e[13]],e[10]=a[0],e[11]=a[1],a}]):d.sequence([function(c){return d.i64.eq(a[0],d.i64.cast([0,2]))?d.sequence([function(c){return a[3]!==void 0?d.sequence([function(c){return d.filter(d.db.table(302).fetch(),function(b){return b.threadId===a[1]&&b.toplevelOfflineThreadingId===a[2]&&b.supplementalKey===a[3]}).next().then(function(c,f){var g=c.done;c=c.value;return g?(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE"),e[19]=new d.Map(),e[19].set("error_code",d.i64.cast([0,64])),e[19].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure"),e[19].set("error_message",""),g=[void 0,e[19]],e[16]=g[0],e[17]=g[1],g):(f=c.item,d.sequence([function(c){return e[19]=a[5].get("mailbox_root_key_v2"),a[5],d.blobs.neq(e[19],void 0)?d.sequence([function(c){return e[22]=a[5].get("message_payload_encryption_keys"),a[5],e[23]=e[22].get("epoch_root_key"),e[22],e[24]=d.createArray(),e[37]=(e[24].push(d.i64.cast([0,32])),e[24]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfcHJmX2tleQ=="),void 0,e[19],e[24]).then(function(a){return a=a,e[25]=a[0],a})},function(a){return e[25]!==void 0?d.sequence([function(a){return e[37]=d.i64.of_int32(e[25].length),d.i64.ge(e[37],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[25],d.i64.cast([0,0])).then(function(a){return a=a,e[39]=a[0],e[40]=a[1],a})},function(a){return e[38]=e[39]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[39]=d.createArray(),void 0!==void 0?e[40]=(e[39].push(void 0),e[39]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",e[39],d.i64.cast([0,3]))},function(a){return e[38]=void 0}])},function(a){return e[26]=e[38]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[37]=d.createArray(),void 0!==void 0?e[38]=(e[37].push(void 0),e[37]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",e[37],d.i64.cast([0,3]))},function(a){return e[26]=void 0}])},function(a){return d.blobs.neq(e[26],void 0)?e[27]=!0:e[27]=!1,e[27]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[28]=d.createArray(),e[37]=(e[28].push(d.i64.cast([0,32])),e[28]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfZW5jX2tleQ=="),void 0,e[23],e[28]).then(function(a){return a=a,e[29]=a[0],a})},function(a){return e[29]!==void 0?d.sequence([function(a){return e[37]=d.i64.of_int32(e[29].length),d.i64.ge(e[37],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[29],d.i64.cast([0,0])).then(function(a){return a=a,e[39]=a[0],e[40]=a[1],a})},function(a){return e[38]=e[39]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[39]=d.createArray(),void 0!==void 0?e[40]=(e[39].push(void 0),e[39]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",e[39],d.i64.cast([0,3]))},function(a){return e[38]=void 0}])},function(a){return e[30]=e[38]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[37]=d.createArray(),void 0!==void 0?e[38]=(e[37].push(void 0),e[37]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",e[37],d.i64.cast([0,3]))},function(a){return e[30]=void 0}])},function(c){return d.blobs.neq(e[30],void 0)?e[31]=!0:e[31]=!1,e[31]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),d.nativeOperation(b("LSGetBlobFromString.nop"),a[3]).then(function(a){return a=a,e[32]=a[0],a})},function(a){return d.nativeOperation(b("LSHmac_v2.nop"),e[26],e[32]).then(function(a){return a=a,e[33]=a[0],a})},function(a){return d.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),e[30],d.blob("c3VwcGxlbWVudGFsX2VuY19hYWQ="),e[32]).then(function(a){return a=a,e[34]=a[0],a})},function(c){return d.blobs.neq(e[34],void 0)?d.sequence([function(c){return e[37]=new d.Map(),e[37].set("sk_ciphertext",e[34]),e[37].set("sk_hash",e[33]),e[38]=a[5].get("message_payload_encryption_keys"),a[5],e[39]=e[38].get("payload_key"),e[38],e[40]=a[6].get("act_thread_id"),a[6],d.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),e[39],d.blobs.of_string(["message_thread","_",e[40]].join("")),f.messagePayload).then(function(a){return a=a,e[41]=a[0],a})},function(a){return d.blobs.neq(e[41],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[41]).then(function(a){return a=a,e[45]=a[0],a})},function(a){return e[42]=e[45]}]):d.resolve(e[42]=void 0)},function(b){return e[42]!==void 0?(e[45]=new d.Map(),e[45].set("backup_action",a[0]),e[45].set("protobuf_encrypted",e[42]),e[45].set("supplemental_data_encrypted",e[37]),e[45].set("timestamp_ms",a[4]),e[45].set("message_tags",void 0),b=[e[45],void 0],e[43]=b[0],e[44]=b[1],b):(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),e[45]=new d.Map(),e[45].set("error_code",d.i64.cast([0,62])),e[45].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure"),e[45].set("error_message",""),b=[void 0,e[45]],e[43]=b[0],e[44]=b[1],b),b=[e[43],e[44]],e[35]=b[0],e[36]=b[1],b}]):d.resolve((function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure] Returning error SUPPLEMENTAL_ENCRYPTION_FAILED"),e[37]=new d.Map(),e[37].set("error_code",d.i64.cast([0,66])),e[37].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure"),e[37].set("error_message",""),c=[void 0,e[37]],e[35]=c[0],e[36]=c[1],c))},function(a){return a=[e[35],e[36]],e[20]=a[0],e[21]=a[1],a}]):d.resolve((function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure] Returning error NULL_MAILBOX_ROOT_KEY_V2"),e[22]=new d.Map(),e[22].set("error_code",d.i64.cast([0,27])),e[22].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure"),e[22].set("error_message",""),c=[void 0,e[22]],e[20]=c[0],e[21]=c[1],c))},function(a){return a=[e[20],e[21]],e[16]=a[0],e[17]=a[1],a}]))})},function(a){return a=[e[16],e[17]],e[14]=a[0],e[15]=a[1],a}]):d.resolve((function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),e[16]=new d.Map(),e[16].set("error_code",d.i64.cast([0,65])),e[16].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure"),e[16].set("error_message",""),c=[void 0,e[16]],e[14]=c[0],e[15]=c[1],c))},function(a){return a=[e[14],e[15]],e[12]=a[0],e[13]=a[1],a}]):d.sequence([function(c){return d.i64.eq(a[0],d.i64.cast([0,4]))?d.sequence([function(c){return d.filter(d.db.table(301).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}).next().then(function(c,f){var g=c.done;c=c.value;return g?(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),e[19]=new d.Map(),e[19].set("error_code",d.i64.cast([0,63])),e[19].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure"),e[19].set("error_message",""),g=[void 0,e[19]],e[16]=g[0],e[17]=g[1],g):(f=c.item,d.sequence([function(b){return e[19]=d.createArray(),d.forEach(d.filter(d.db.table(304).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}),function(a){a=a.item;return e[27]=(e[19].push(a.tag),e[19])})},function(c){return e[20]=a[5].get("message_payload_encryption_keys"),a[5],e[21]=e[20].get("payload_key"),e[20],e[22]=a[6].get("act_thread_id"),a[6],d.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),e[21],d.blobs.of_string(["message_thread","_",e[22]].join("")),f.messagePayload).then(function(a){return a=a,e[23]=a[0],a})},function(a){return d.blobs.neq(e[23],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[23]).then(function(a){return a=a,e[27]=a[0],a})},function(a){return e[24]=e[27]}]):d.resolve(e[24]=void 0)},function(b){return e[24]!==void 0?(e[19]!==void 0?(e[29]=new d.Map(),e[29].set("message_tags",e[19]),e[30]=d.toJSON(e[29]),e[27]=e[30]):e[27]=void 0,e[28]=new d.Map(),e[28].set("backup_action",a[0]),e[28].set("protobuf_encrypted",e[24]),e[28].set("supplemental_data_encrypted",void 0),e[28].set("timestamp_ms",a[4]),e[28].set("message_tags",e[27]),b=[e[28],void 0],e[25]=b[0],e[26]=b[1],b):(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),e[27]=new d.Map(),e[27].set("error_code",d.i64.cast([0,62])),e[27].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure"),e[27].set("error_message",""),b=[void 0,e[27]],e[25]=b[0],e[26]=b[1],b),b=[e[25],e[26]],e[16]=b[0],e[17]=b[1],b}]))})},function(a){return a=[e[16],e[17]],e[14]=a[0],e[15]=a[1],a}]):d.resolve((d.i64.eq(a[0],d.i64.cast([0,3]))?(e[18]=new d.Map(),e[18].set("backup_action",a[0]),e[18].set("protobuf_encrypted",void 0),e[18].set("supplemental_data_encrypted",void 0),e[18].set("timestamp_ms",a[4]),e[18].set("message_tags",void 0),c=[e[18],void 0],e[16]=c[0],e[17]=c[1],c):(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure] Returning error UNKNOWN"),e[18]=new d.Map(),e[18].set("error_code",d.i64.cast([0,603])),e[18].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure"),e[18].set("error_message",""),c=[void 0,e[18]],e[16]=c[0],e[17]=c[1],c),c=[e[16],e[17]],e[14]=c[0],e[15]=c[1],c))},function(a){return a=[e[14],e[15]],e[12]=a[0],e[13]=a[1],a}])},function(a){return a=[e[12],e[13]],e[10]=a[0],e[11]=a[1],a}])},function(a){return a=[e[10],e[11]],e[2]=a[0],e[3]=a[1],a}]):d.resolve((function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure] Returning error NOT_SUPPORTED_ON_WEB"),e[10]=new d.Map(),e[10].set("error_code",d.i64.cast([0,7])),e[10].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsStoredProcedure"),e[10].set("error_message",""),f=[void 0,e[10]],e[2]=f[0],e[3]=f[1],f))},function(a){return e[4]=d.i64.of_float(Date.now()),e[5]=d.i64.random(),e[7]="Finishing execution. Execution time: ",e[8]=d.i64.to_string(d.i64.sub(e[4],e[0])),e[9]=" ms",e[6]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][loadAndEncryptProtobufWithInputs] ",e[6],e[7],e[6],e[8],e[6],e[9]].join("")),d.i64.eq(d.i64.mod_(e[5],d.i64.cast([0,100])),d.i64.cast([0,0]))?(e[10]=",",e[11]=d.createArray(),void 0!==void 0?e[12]=(e[11].push(void 0),e[11]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"loadAndEncryptProtobufWithInputs",[e[7],e[10],e[8],e[10],e[9]].join(""),e[11],d.i64.cast([0,4]))):d.resolve()},function(a){return a=[e[2],e[3]],f[0]=a[0],f[1]=a[1],a}])},function(a){return d.resolve(f)}])}d=a;g["default"]=d}),98);
__d("LSLoadAndEncryptProtobuf",["LSLoadAndEncryptProtobufWithInputs","LSLogMebClientEvent.nop","gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][loadAndEncryptProtobuf] Beginning execution."),e[1]=d.i64.of_float(Date.now()),(c("gkx")("7350")||c("gkx")("4765"))&&c("gkx")("7298")?d.sequence([function(c){return d.filter(d.db.table(305).fetch(),function(b){return d.i64.eq(b.pendingBackupTaskId,a[0])}).next().then(function(c,f){var g=c.done;c=c.value;return g?(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufStoredProcedure] Returning error PROTOBUF_CONTEXT_ROW_NOT_FOUND"),e[13]=new d.Map(),e[13].set("error_code",d.i64.cast([0,67])),e[13].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufStoredProcedure"),e[13].set("error_message",""),g=[void 0,e[13]],e[10]=g[0],e[11]=g[1],g):(f=c.item,d.sequence([function(c){return d.storedProcedure(b("LSLoadAndEncryptProtobufWithInputs"),f.backupAction,f.actThreadId,f.toplevelOfflineThreadingId,f.supplementalKey,f.messageTimestampMs,a[1],a[2]).then(function(a){return a=a,e[13]=a[0],e[14]=a[1],a})},function(a){return a=[e[13],e[14]],e[10]=a[0],e[11]=a[1],a}]))})},function(a){return a=[e[10],e[11]],e[2]=a[0],e[3]=a[1],a}]):d.resolve((function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufStoredProcedure] Returning error NOT_SUPPORTED_ON_WEB"),e[10]=new d.Map(),e[10].set("error_code",d.i64.cast([0,7])),e[10].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufStoredProcedure"),e[10].set("error_message",""),f=[void 0,e[10]],e[2]=f[0],e[3]=f[1],f))},function(a){return e[4]=d.i64.of_float(Date.now()),e[5]=d.i64.random(),e[7]="Finishing execution. Execution time: ",e[8]=d.i64.to_string(d.i64.sub(e[4],e[0])),e[9]=" ms",e[6]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][loadAndEncryptProtobuf] ",e[6],e[7],e[6],e[8],e[6],e[9]].join("")),d.i64.eq(d.i64.mod_(e[5],d.i64.cast([0,100])),d.i64.cast([0,0]))?(e[10]=",",e[11]=d.createArray(),void 0!==void 0?e[12]=(e[11].push(void 0),e[11]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"loadAndEncryptProtobuf",[e[7],e[10],e[8],e[10],e[9]].join(""),e[11],d.i64.cast([0,4]))):d.resolve()},function(a){return a=[e[2],e[3]],f[0]=a[0],f[1]=a[1],a}])},function(a){return d.resolve(f)}])}d=a;g["default"]=d}),98);
__d("LSSerializeBackupPayloadV2",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSEncryptIdentifiers","LSEncryptMessagePayload","LSGetBlobFromString.nop","LSGetLatestEpochKeys","LSIsEncryptionVersionSecure","LSIsMobileClient","LSLoadAndEncryptProtobuf","LSLogMebClientEvent.nop","gkx","justknobx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][serializeBackupPayloadV2] Beginning execution."),e[1]=d.i64.of_float(Date.now()),e[9]=d.i64.mul(e[1],d.i64.cast([0,1e6])),(c("gkx")("7350")||c("gkx")("4765"))&&c("justknobx")._("1071")?d.sequence([function(c){return d.islc(d.filter(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))||!1}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(c,f){var g=c.done;c=c.value;return g?d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[30]=d.i64.of_float(Date.now()),b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[30],d.i64.cast([0,1e6])),e[9]),void 0],e[18]=b[0],e[19]=b[1],e[20]=b[2],e[21]=b[3],e[22]=b[4],e[23]=b[5],e[24]=b[6],b):(f=c.item,e[30]=d.i64.of_float(Date.now()),b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[30],d.i64.cast([0,1e6])),e[9]),void 0],e[18]=b[0],e[19]=b[1],e[20]=b[2],e[21]=b[3],e[22]=b[4],e[23]=b[5],e[24]=b[6],b)})},function(a){return e[26]=new d.Map(),e[26].set("task_id",e[18]),e[26].set("queue_name",e[19]),e[26].set("enqueue_timestamp_ms",e[20]),e[26].set("priority",e[21]),e[26].set("first_executed_timestamp_ms",e[22]),e[26].set("execution_time_ns",e[23]),e[26].set("echo_encoding_execution_time_ns",e[24]),e[27]=new d.Map(),e[27].set("task_metadata",e[26]),e[27].set("action_type",void 0),e[27].set("content_type",void 0),e[27].set("identifiers",void 0),e[27].set("task_creation_source",void 0),e[27].set("message_payload_source",d.i64.cast([0,2])),e[28]=new d.Map(),e[28].set("error_code",d.i64.cast([0,1])),e[28].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[28].set("error_message",""),e[29]=d.createArray(),a=[void 0,e[28],e[27],e[29]],e[13]=a[0],e[14]=a[1],e[15]=a[2],e[16]=a[3],a}]):(f=c.item,d.sequence([function(a){return e[27]=f.mailboxRootKeyBlob,e[28]=f.deviceId,e[26]=f.backupTenancy,e[25]=f.encryptionVersion,d.i64.neq(void 0,void 0)?d.resolve(e[18]=void 0):d.sequence([function(a){return e[29]=d.createArray(),d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[30]=a[0],a})},function(a){return e[30]?e[39]=(e[29].push(d.i64.cast([0,0])),e[29]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[31]=a[0],a})},function(a){return e[31]?e[39]=(e[29].push(d.i64.cast([0,2])),e[29]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[32]=a[0],a})},function(a){return e[32]?e[39]=(e[29].push(d.i64.cast([0,3])),e[29]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[33]=a[0],a})},function(a){return e[33]?e[39]=(e[29].push(d.i64.cast([0,4])),e[29]):0,e[34]=d.createArray(),e[35]=d.i64.of_int32(e[29].length),d.i64.gt(e[35],d.i64.cast([0,0]))?d.loopAsync(e[35],function(a){return e[39]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[29],e[39]).then(function(a){return a=a,e[40]=a[0],e[41]=a[1],a})},function(a){return e[42]=(e[34].push(e[40]),e[34])}])}):d.resolve()},function(a){return d.sequence([function(a){return e[39]=d.createArray(),e[40]=d.i64.of_int32(e[34].length),d.i64.gt(e[40],d.i64.cast([0,0]))?d.loopAsync(e[40],function(a){return e[42]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[34],e[42]).then(function(a){return a=a,e[43]=a[0],e[44]=a[1],a})},function(a){return e[45]=(e[39].push(d.i64.to_string(e[43])),e[39])}])}):d.resolve()},function(a){return e[41]=e[39].join(","),e[36]=e[41]}])},function(a){return e[34].some(function(a){return d.i64.eq(e[25],a)})?e[37]=e[25]:e[37]=void 0,d.i64.neq(e[37],void 0)?e[38]=e[37]:e[38]=void 0,e[18]=e[38]}])},function(c){return d.i64.neq(e[18],void 0)?e[19]=e[18]:e[19]=d.i64.cast([0,0]),d.i64.neq(e[26],void 0)?e[20]=e[26]:e[20]=d.i64.cast([0,1]),d.i64.neq(e[28],void 0)?d.sequence([function(c){return d.db.table(177).fetch([[[a[0]]],"fk_pending_tasks"]).next().then(function(g,h){var c=g.done;g=g.value;return c?d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[46]=d.i64.of_float(Date.now()),b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[46],d.i64.cast([0,1e6])),e[9]),void 0],e[34]=b[0],e[35]=b[1],e[36]=b[2],e[37]=b[3],e[38]=b[4],e[39]=b[5],e[40]=b[6],b):(f=c.item,e[46]=d.i64.of_float(Date.now()),b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[46],d.i64.cast([0,1e6])),e[9]),void 0],e[34]=b[0],e[35]=b[1],e[36]=b[2],e[37]=b[3],e[38]=b[4],e[39]=b[5],e[40]=b[6],b)})},function(a){return e[42]=new d.Map(),e[42].set("task_id",e[34]),e[42].set("queue_name",e[35]),e[42].set("enqueue_timestamp_ms",e[36]),e[42].set("priority",e[37]),e[42].set("first_executed_timestamp_ms",e[38]),e[42].set("execution_time_ns",e[39]),e[42].set("echo_encoding_execution_time_ns",e[40]),e[43]=new d.Map(),e[43].set("task_metadata",e[42]),e[43].set("action_type",void 0),e[43].set("content_type",void 0),e[43].set("identifiers",void 0),e[43].set("task_creation_source",void 0),e[43].set("message_payload_source",d.i64.cast([0,2])),e[44]=new d.Map(),e[44].set("error_code",d.i64.cast([0,5])),e[44].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[44].set("error_message","Pending backup context row not found"),e[45]=d.createArray(),a=[void 0,e[44],e[43],e[45]],e[29]=a[0],e[30]=a[1],e[31]=a[2],e[32]=a[3],a}]):(h=g.item,d.sequence([function(a){return e[42]=h.actionType,e[41]=h.contentType,e[40]=h.listKey,e[43]=h.echoContent,e[44]=h.lsTraceId,e[45]=h.echoEncodingLatencyNs,d.i64.eq(e[42],d.i64.cast([0,2]))&&d.i64.eq(e[41],d.i64.cast([0,2]))?d.resolve(e[34]=""):d.sequence([function(a){return d.db.table(173).fetch([[[d.i64.from_string(e[40])]],"jid"]).next().then(function(b,c){var a=b.done;b=b.value;return a?e[47]="":(c=b.item,e[47]=d.i64.to_string(c.serverThreadKey))})},function(a){return e[34]=e[47]}])},function(c){return e[35]=new d.Map(),e[35].set("backup_id",d.i64.to_string(f.backupId)),e[35].set("act_thread_id",e[40]),e[35].set("server_thread_id",e[34]),e[35].set("timestamp",h.sortKey),e[35].set("otid",h.uniqueKey),e[46]=h.error==null?d.i64.cast([0,0]):h.error,d.i64.eq(e[46],d.i64.cast([0,0]))?d.sequence([function(a){return d.storedProcedure(b("LSGetLatestEpochKeys"),!1).then(function(a){return a=a,e[47]=a[0],e[48]=a[1],a})},function(a){return e[47]!==void 0?d.sequence([function(a){return d.i64.eq(e[41],d.i64.cast([0,1]))?d.sequence([function(a){return e[58]=e[35].get("act_thread_id"),e[35],e[59]=d.createArray(),e[64]=(e[59].push(d.i64.cast([0,32])),e[59]),d.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",e[58]].join("")).then(function(a){return a=a,e[60]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[60],void 0,e[27],e[59]).then(function(a){return a=a,e[61]=a[0],a})},function(a){return e[61]?e[62]=!1:e[62]=!0,e[62]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),e[64]=d.createArray(),void 0!==void 0?e[65]=(e[64].push(void 0),e[64]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",e[64],d.i64.cast([0,3]))},function(a){return e[63]=void 0}]):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[61],d.i64.cast([0,0])).then(function(a){return a=a,e[64]=a[0],e[65]=a[1],a})},function(a){return e[63]=e[64]}])},function(a){return e[55]=e[63]}]):d.sequence([function(a){return d.i64.eq(e[42],d.i64.cast([0,2]))?d.sequence([function(a){return e[59]=e[35].get("otid"),e[35],e[60]=d.createArray(),e[65]=(e[60].push(d.i64.cast([0,32])),e[60]),d.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",e[59]].join("")).then(function(a){return a=a,e[61]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[61],void 0,e[27],e[60]).then(function(a){return a=a,e[62]=a[0],a})},function(a){return e[62]?e[63]=!1:e[63]=!0,e[63]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),e[65]=d.createArray(),void 0!==void 0?e[66]=(e[65].push(void 0),e[65]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",e[65],d.i64.cast([0,3]))},function(a){return e[64]=void 0}]):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[62],d.i64.cast([0,0])).then(function(a){return a=a,e[65]=a[0],e[66]=a[1],a})},function(a){return e[64]=e[65]}])},function(a){return e[58]=e[64]}]):d.resolve(e[58]=void 0)},function(a){return e[55]=e[58]}])},function(a){return d.blobs.neq(e[55],void 0)?d.sequence([function(a){return e[58]=e[47].get("epoch_keys"),e[47],e[59]=e[58].get("epoch_anon_id"),e[58],e[60]=e[58].get("epoch_root_key"),e[58],e[61]=e[35].get("act_thread_id"),e[35],e[62]=d.createArray(),e[73]=(e[62].push(d.i64.cast([0,32])),e[62]),d.i64.ge(e[19],d.i64.cast([0,3]))?d.resolve(e[63]=void 0):d.sequence([function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),e[61]).then(function(a){return a=a,e[73]=a[0],a})},function(a){return e[63]=e[73]}])},function(a){return d.i64.ge(e[19],d.i64.cast([0,4]))?(e[73]="_",e[64]=["message_key_in_epoch",e[73],d.blobs.to_string(e[59]),e[73],"cipher_version",e[73],d.i64.to_string(e[19]),e[73],"thread",e[73],e[61]==null?"":e[61]].join("")):(d.i64.ge(e[19],d.i64.cast([0,3]))?(e[74]="_",e[73]=["message_key_in_epoch",e[74],d.blobs.to_string(e[59]),e[74],"cipher_version",e[74],d.i64.to_string(e[19]),e[74],"thread",e[74],e[61]==null?"":e[61]].join("")):(d.i64.ge(e[19],d.i64.cast([0,2]))?(e[75]="_",e[74]=["message_key_in_epoch",e[75],d.blobs.to_string(e[59]),e[75],"cipher_version",e[75],d.i64.to_string(e[19])].join("")):e[74]=["message_key_in_epoch","_",d.blobs.to_string(e[59])].join(""),e[73]=e[74]),e[64]=e[73]),d.nativeOperation(b("LSGetBlobFromString.nop"),e[64]).then(function(a){return a=a,e[65]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[65],e[63],e[60],e[62]).then(function(a){return a=a,e[66]=a[0],a})},function(a){return e[66]?e[67]=!1:e[67]=!0,e[67]?d.resolve(e[68]=void 0):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[66],d.i64.cast([0,0])).then(function(a){return a=a,e[73]=a[0],e[74]=a[1],a})},function(a){return e[68]=e[73]}])},function(a){return d.filter(d.db.table(169).fetch(),function(a){return d.blobs.eq(a.epochAnonIdBlob,d.blob("MA=="))}).next().then(function(c,f){var a=c.done;c=c.value;return a?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTableUtils] Failed to get mailbox_root_key_v2: epoch 0 is not available."),e[73]=d.createArray(),void 0!==void 0?e[74]=(e[73].push(void 0),e[73]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTableUtils","Failed to get mailbox_root_key_v2: epoch 0 is not available.",e[73],d.i64.cast([0,3]))},function(a){return e[69]=void 0}]):(f=c.item,d.sequence([function(a){return e[73]=d.createArray(),e[81]=(e[73].push(d.i64.cast([0,32])),e[73]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5zYWx0X21haWxib3hfcm9vdF9rZXlfdjI="),void 0,e[27],e[73]).then(function(a){return a=a,e[74]=a[0],a})},function(a){return e[74]!==void 0?d.sequence([function(a){return e[81]=d.i64.of_int32(e[74].length),d.i64.ge(e[81],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[74],d.i64.cast([0,0])).then(function(a){return a=a,e[83]=a[0],e[84]=a[1],a})},function(a){return e[82]=e[83]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[83]=d.createArray(),void 0!==void 0?e[84]=(e[83].push(void 0),e[83]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",e[83],d.i64.cast([0,3]))},function(a){return e[82]=void 0}])},function(a){return e[75]=e[82]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[81]=d.createArray(),void 0!==void 0?e[82]=(e[81].push(void 0),e[81]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",e[81],d.i64.cast([0,3]))},function(a){return e[75]=void 0}])},function(a){return d.blobs.neq(e[75],void 0)?e[76]=!0:e[76]=!1,e[76]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[77]=d.createArray(),e[81]=(e[77].push(d.i64.cast([0,32])),e[77]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5tYWlsYm94X3Jvb3Rfa2V5X3Yy"),e[75],f.epochRootKeyBlob,e[77]).then(function(a){return a=a,e[78]=a[0],a})},function(a){return e[78]!==void 0?d.sequence([function(a){return e[81]=d.i64.of_int32(e[78].length),d.i64.ge(e[81],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[78],d.i64.cast([0,0])).then(function(a){return a=a,e[83]=a[0],e[84]=a[1],a})},function(a){return e[82]=e[83]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[83]=d.createArray(),void 0!==void 0?e[84]=(e[83].push(void 0),e[83]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",e[83],d.i64.cast([0,3]))},function(a){return e[82]=void 0}])},function(a){return e[79]=e[82]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[81]=d.createArray(),void 0!==void 0?e[82]=(e[81].push(void 0),e[81]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",e[81],d.i64.cast([0,3]))},function(a){return e[79]=void 0}])},function(a){return d.blobs.neq(e[79],void 0)?e[80]=!0:e[80]=!1,e[80]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[69]=e[79]}]))})},function(a){return d.blobs.neq(e[68],void 0)?d.sequence([function(a){return d.blobs.neq(e[69],void 0)?d.sequence([function(a){return e[79]=d.createArray(),e[83]=(e[79].push(d.i64.cast([0,32])),e[79]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5mYWxsYmFja19rZXk="),void 0,e[69],e[79]).then(function(a){return a=a,e[80]=a[0],a})},function(a){return e[80]!==void 0?d.sequence([function(a){return e[83]=d.i64.of_int32(e[80].length),d.i64.ge(e[83],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[80],d.i64.cast([0,0])).then(function(a){return a=a,e[85]=a[0],e[86]=a[1],a})},function(a){return e[84]=e[85]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[85]=d.createArray(),void 0!==void 0?e[86]=(e[85].push(void 0),e[85]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",e[85],d.i64.cast([0,3]))},function(a){return e[84]=void 0}])},function(a){return e[81]=e[84]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[83]=d.createArray(),void 0!==void 0?e[84]=(e[83].push(void 0),e[83]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",e[83],d.i64.cast([0,3]))},function(a){return e[81]=void 0}])},function(a){return d.blobs.neq(e[81],void 0)?e[82]=!0:e[82]=!1,e[82]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[73]=e[81]}]):d.resolve(e[73]=void 0)},function(a){return e[74]=e[58].get("epoch_root_key"),e[58],e[75]=e[58].get("epoch_anon_id"),e[58],e[76]=e[58].get("epoch_id"),e[58],e[77]=new d.Map(),e[77].set("payload_key",e[68]),e[77].set("payload_fallback_key",e[73]),e[77].set("encryption_version",e[19]),e[77].set("epoch_root_key",e[74]),e[77].set("epoch_anon_id",e[75]),e[77].set("epoch_id",e[76]),e[78]=new d.Map(),e[78].set("ope_key",e[55]),e[78].set("message_payload_encryption_keys",e[77]),e[78].set("ocmf_shared_key",f.ocmfClientStateBlob),e[78].set("mailbox_base_salt",e[27]),e[78].set("mailbox_root_key_v2",e[69]),a=[e[78],void 0],e[71]=a[0],e[72]=a[1],a}]):d.resolve((e[73]=new d.Map(),e[73].set("error_code",d.i64.cast([0,26])),e[73].set("stored_procedure","MEBKeyDeriver"),e[73].set("error_message",""),a=[void 0,e[73]],e[71]=a[0],e[72]=a[1],a))},function(a){return a=[e[71],e[72]],e[56]=a[0],e[57]=a[1],a}]):d.resolve((e[58]=new d.Map(),e[58].set("error_code",d.i64.cast([0,25])),e[58].set("stored_procedure","MEBKeyDeriver"),e[58].set("error_message",""),a=[void 0,e[58]],e[56]=a[0],e[57]=a[1],a))},function(a){return a=[e[56],e[57]],e[49]=a[0],e[50]=a[1],a}]):d.resolve((a=[void 0,e[48]],e[49]=a[0],e[50]=a[1],a))},function(c){return e[49]!==void 0?d.sequence([function(a){return d.storedProcedure(b("LSEncryptIdentifiers"),e[42],e[41],e[35],e[49]).then(function(a){return a=a,e[55]=a[0],e[56]=a[1],a})},function(c){return e[55]!==void 0?d.sequence([function(c){return d.i64.eq(e[42],d.i64.cast([0,1]))?(e[69]=e[43]===""?void 0:e[43],e[69]!==void 0?(c=[e[69],void 0],e[67]=c[0],e[68]=c[1],c):(e[70]=new d.Map(),e[70].set("error_code",d.i64.cast([0,30])),e[70].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[70].set("error_message",""),c=[void 0,e[70]],e[67]=c[0],e[68]=c[1],c),c=[e[67],e[68]],e[61]=c[0],e[62]=c[1],c):(c=["",void 0],e[61]=c[0],e[62]=c[1],c),e[61]!==void 0?d.sequence([function(a){return d.i64.eq(e[42],d.i64.cast([0,1]))?d.sequence([function(a){return d.storedProcedure(b("LSEncryptMessagePayload"),e[35],e[49],e[61]).then(function(a){return a=a,e[73]=a[0],e[74]=a[1],a})},function(a){return a=[e[73],e[74]],e[67]=a[0],e[68]=a[1],a}]):d.resolve((e[73]=new d.Map(),e[73].set("encrypted_message_payload",""),e[73].set("value_secret_ref",""),a=[e[73],void 0],e[67]=a[0],e[68]=a[1],a))},function(c){return e[67]!==void 0?d.sequence([function(c){return d.storedProcedure(b("LSLoadAndEncryptProtobuf"),a[0],e[49],e[35]).then(function(a){return a=a,e[73]=a[0],e[74]=a[1],a})},function(a){return e[75]=e[55].get("act_thread_id_ocmf_partial"),e[55],e[76]=e[55].get("otid_ocmf_partial"),e[55],e[77]=e[55].get("timestamp_encrypted"),e[55],e[78]=new d.Map(),e[78].set("list_key",e[75]),e[78].set("unique_key",e[76]),e[78].set("sort_key",e[77]),e[79]=e[67].get("encrypted_message_payload"),e[67],e[80]=e[67].get("value_secret_ref"),e[67],e[81]=new d.Map(),e[81].set("value",e[79]),e[81].set("value_secret_ref",e[80]),e[82]=new d.Map(),e[82].set("list_item_id",e[78]),e[82].set("list_item",e[81]),e[82].set("action_type",e[42]),e[83]=e[35].get("server_thread_id"),e[35],e[84]=e[35].get("timestamp"),e[35],e[85]=e[35].get("otid"),e[35],e[86]=e[35].get("act_thread_id"),e[35],e[87]=new d.Map(),e[87].set("server_thread_key",e[83]),e[87].set("timestamp",e[84]),e[87].set("otid",e[85]),e[87].set("wa_thread_id",d.i64.from_string(e[86])),e[88]=e[49].get("mailbox_base_salt"),e[49],d.nativeOperation(b("LSBase64Encode.nop"),e[88]).then(function(a){return a=a,e[89]=a[0],a})},function(a){return e[90]=e[49].get("ocmf_shared_key"),e[49],d.nativeOperation(b("LSBase64Encode.nop"),e[90]).then(function(a){return a=a,e[91]=a[0],a})},function(a){return e[92]=new d.Map(),e[92].set("mailbox_root_key",e[89]==null?"":e[89]),e[92].set("ocmf_client_state_blob",e[91]==null?"":e[91]),e[93]=e[55].get("backup_id_ocmf_partial"),e[55],e[94]=e[49].get("message_payload_encryption_keys"),e[49],e[95]=e[94].get("epoch_id"),e[94],e[96]=e[49].get("message_payload_encryption_keys"),e[49],e[97]=e[96].get("encryption_version"),e[96],e[98]=new d.Map(),e[98].set("mailbox_partial_id",e[93]),e[98].set("action",e[82]),e[98].set("device_id",e[28]),e[98].set("echo_version",d.i64.cast([0,0])),e[98].set("epoch_id",e[95]),e[98].set("trace_id",void 0),e[98].set("encryption_version",e[97]),e[98].set("is_thread",d.i64.eq(e[41],d.i64.cast([0,2]))),e[98].set("raw_identifiers",e[87]),e[98].set("raw_tokens",e[92]),e[98].set("request_id",e[44]==null?"":e[44]),e[98].set("tam_thread_subtype",d.i64.cast([0,0])),e[98].set("is_instamadillo",!1),e[73]!==void 0?d.sequence([function(a){return e[114]=e[73].get("supplemental_data_encrypted"),e[73],e[114]!==void 0?d.sequence([function(a){return e[116]=e[73].get("protobuf_encrypted"),e[73],e[117]=e[73].get("backup_action"),e[73],e[118]=e[73].get("timestamp_ms"),e[73],e[119]=e[114].get("sk_ciphertext"),e[114],d.nativeOperation(b("LSBase64Encode.nop"),e[119]).then(function(a){return a=a,e[120]=a[0],a})},function(a){return e[121]=e[114].get("sk_hash"),e[114],d.nativeOperation(b("LSBase64Encode.nop"),e[121]).then(function(a){return a=a,e[122]=a[0],a})},function(a){return e[123]=e[73].get("message_tags"),e[73],e[124]=new d.Map(),e[124].set("supplementary_data_key",void 0),e[124].set("encrypted_protobuf",e[116]),e[124].set("key_value_backup_action",e[117]),e[124].set("protobuf_ts_ms",e[118]),e[124].set("supplemental_key_ciphertext",e[120]),e[124].set("supplemental_key_hash",e[122]),e[124].set("message_tags",e[123]),e[115]=e[124]}]):d.resolve((e[116]=e[73].get("protobuf_encrypted"),e[73],e[117]=e[73].get("backup_action"),e[73],e[118]=e[73].get("timestamp_ms"),e[73],e[119]=e[73].get("message_tags"),e[73],e[120]=new d.Map(),e[120].set("supplementary_data_key",void 0),e[120].set("encrypted_protobuf",e[116]),e[120].set("key_value_backup_action",e[117]),e[120].set("protobuf_ts_ms",e[118]),e[120].set("message_tags",e[119]),e[115]=e[120]))},function(a){return e[98].set("key_value_backup_payload",e[115])}]):d.resolve()},function(a){return d.resolve(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure] Skip processing attachments as not enabled."))},function(a){return e[44]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),e[44],d.i64.cast([0,1463]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[99]=a[0],a})},function(a){return e[99]?e[100]=!0:e[100]=!1,e[100]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[114]=d.createArray(),void 0!==void 0?e[115]=(e[114].push(void 0),e[114]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[114],d.i64.cast([0,3]))):d.resolve()},function(b){return e[101]=d.toJSON(e[98]),d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[114]=d.i64.of_float(Date.now()),d.i64.eq(e[45],d.i64.cast([0,0]))||d.i64.eq(e[45],void 0)?e[115]=void 0:e[115]=e[45],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[114],d.i64.cast([0,1e6])),e[9]),e[115]],e[102]=b[0],e[103]=b[1],e[104]=b[2],e[105]=b[3],e[106]=b[4],e[107]=b[5],e[108]=b[6],b):(f=c.item,e[114]=d.i64.of_float(Date.now()),d.i64.eq(e[45],d.i64.cast([0,0]))||d.i64.eq(e[45],void 0)?e[115]=void 0:e[115]=e[45],b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[114],d.i64.cast([0,1e6])),e[9]),e[115]],e[102]=b[0],e[103]=b[1],e[104]=b[2],e[105]=b[3],e[106]=b[4],e[107]=b[5],e[108]=b[6],b)})},function(a){return e[110]=new d.Map(),e[110].set("task_id",e[102]),e[110].set("queue_name",e[103]),e[110].set("enqueue_timestamp_ms",e[104]),e[110].set("priority",e[105]),e[110].set("first_executed_timestamp_ms",e[106]),e[110].set("execution_time_ns",e[107]),e[110].set("echo_encoding_execution_time_ns",e[108]),e[111]=new d.Map(),e[111].set("task_metadata",e[110]),e[111].set("action_type",e[42]),e[111].set("content_type",e[41]),e[111].set("identifiers",e[35]),e[111].set("task_creation_source",void 0),e[111].set("message_payload_source",d.i64.cast([0,2])),e[112]=new d.Map(),e[112].set("payload",e[101]),e[113]=d.createArray(),e[114]=(e[113].push(e[74]),e[113]),a=[e[112],void 0,e[111],e[113]],e[69]=a[0],e[70]=a[1],e[71]=a[2],e[72]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[84]=d.i64.of_float(Date.now()),d.i64.eq(e[45],d.i64.cast([0,0]))||d.i64.eq(e[45],void 0)?e[85]=void 0:e[85]=e[45],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[84],d.i64.cast([0,1e6])),e[9]),e[85]],e[73]=b[0],e[74]=b[1],e[75]=b[2],e[76]=b[3],e[77]=b[4],e[78]=b[5],e[79]=b[6],b):(f=c.item,e[84]=d.i64.of_float(Date.now()),d.i64.eq(e[45],d.i64.cast([0,0]))||d.i64.eq(e[45],void 0)?e[85]=void 0:e[85]=e[45],b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[84],d.i64.cast([0,1e6])),e[9]),e[85]],e[73]=b[0],e[74]=b[1],e[75]=b[2],e[76]=b[3],e[77]=b[4],e[78]=b[5],e[79]=b[6],b)})},function(a){return e[81]=new d.Map(),e[81].set("task_id",e[73]),e[81].set("queue_name",e[74]),e[81].set("enqueue_timestamp_ms",e[75]),e[81].set("priority",e[76]),e[81].set("first_executed_timestamp_ms",e[77]),e[81].set("execution_time_ns",e[78]),e[81].set("echo_encoding_execution_time_ns",e[79]),e[82]=new d.Map(),e[82].set("task_metadata",e[81]),e[82].set("action_type",e[42]),e[82].set("content_type",e[41]),e[82].set("identifiers",e[35]),e[82].set("task_creation_source",void 0),e[82].set("message_payload_source",d.i64.cast([0,2])),e[83]=d.createArray(),a=[void 0,e[68],e[82],e[83]],e[69]=a[0],e[70]=a[1],e[71]=a[2],e[72]=a[3],a}])},function(a){return a=[e[69],e[70],e[71],e[72]],e[63]=a[0],e[64]=a[1],e[65]=a[2],e[66]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[78]=d.i64.of_float(Date.now()),d.i64.eq(e[45],d.i64.cast([0,0]))||d.i64.eq(e[45],void 0)?e[79]=void 0:e[79]=e[45],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[78],d.i64.cast([0,1e6])),e[9]),e[79]],e[67]=b[0],e[68]=b[1],e[69]=b[2],e[70]=b[3],e[71]=b[4],e[72]=b[5],e[73]=b[6],b):(f=c.item,e[78]=d.i64.of_float(Date.now()),d.i64.eq(e[45],d.i64.cast([0,0]))||d.i64.eq(e[45],void 0)?e[79]=void 0:e[79]=e[45],b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[78],d.i64.cast([0,1e6])),e[9]),e[79]],e[67]=b[0],e[68]=b[1],e[69]=b[2],e[70]=b[3],e[71]=b[4],e[72]=b[5],e[73]=b[6],b)})},function(a){return e[75]=new d.Map(),e[75].set("task_id",e[67]),e[75].set("queue_name",e[68]),e[75].set("enqueue_timestamp_ms",e[69]),e[75].set("priority",e[70]),e[75].set("first_executed_timestamp_ms",e[71]),e[75].set("execution_time_ns",e[72]),e[75].set("echo_encoding_execution_time_ns",e[73]),e[76]=new d.Map(),e[76].set("task_metadata",e[75]),e[76].set("action_type",e[42]),e[76].set("content_type",e[41]),e[76].set("identifiers",e[35]),e[76].set("task_creation_source",void 0),e[76].set("message_payload_source",d.i64.cast([0,2])),e[77]=d.createArray(),a=[void 0,e[62],e[76],e[77]],e[63]=a[0],e[64]=a[1],e[65]=a[2],e[66]=a[3],a}])},function(a){return a=[e[63],e[64],e[65],e[66]],e[57]=a[0],e[58]=a[1],e[59]=a[2],e[60]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[72]=d.i64.of_float(Date.now()),d.i64.eq(e[45],d.i64.cast([0,0]))||d.i64.eq(e[45],void 0)?e[73]=void 0:e[73]=e[45],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[72],d.i64.cast([0,1e6])),e[9]),e[73]],e[61]=b[0],e[62]=b[1],e[63]=b[2],e[64]=b[3],e[65]=b[4],e[66]=b[5],e[67]=b[6],b):(f=c.item,e[72]=d.i64.of_float(Date.now()),d.i64.eq(e[45],d.i64.cast([0,0]))||d.i64.eq(e[45],void 0)?e[73]=void 0:e[73]=e[45],b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[72],d.i64.cast([0,1e6])),e[9]),e[73]],e[61]=b[0],e[62]=b[1],e[63]=b[2],e[64]=b[3],e[65]=b[4],e[66]=b[5],e[67]=b[6],b)})},function(a){return e[69]=new d.Map(),e[69].set("task_id",e[61]),e[69].set("queue_name",e[62]),e[69].set("enqueue_timestamp_ms",e[63]),e[69].set("priority",e[64]),e[69].set("first_executed_timestamp_ms",e[65]),e[69].set("execution_time_ns",e[66]),e[69].set("echo_encoding_execution_time_ns",e[67]),e[70]=new d.Map(),e[70].set("task_metadata",e[69]),e[70].set("action_type",e[42]),e[70].set("content_type",e[41]),e[70].set("identifiers",e[35]),e[70].set("task_creation_source",void 0),e[70].set("message_payload_source",d.i64.cast([0,2])),e[71]=d.createArray(),a=[void 0,e[56],e[70],e[71]],e[57]=a[0],e[58]=a[1],e[59]=a[2],e[60]=a[3],a}])},function(a){return a=[e[57],e[58],e[59],e[60]],e[51]=a[0],e[52]=a[1],e[53]=a[2],e[54]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[66]=d.i64.of_float(Date.now()),d.i64.eq(e[45],d.i64.cast([0,0]))||d.i64.eq(e[45],void 0)?e[67]=void 0:e[67]=e[45],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[66],d.i64.cast([0,1e6])),e[9]),e[67]],e[55]=b[0],e[56]=b[1],e[57]=b[2],e[58]=b[3],e[59]=b[4],e[60]=b[5],e[61]=b[6],b):(f=c.item,e[66]=d.i64.of_float(Date.now()),d.i64.eq(e[45],d.i64.cast([0,0]))||d.i64.eq(e[45],void 0)?e[67]=void 0:e[67]=e[45],b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[66],d.i64.cast([0,1e6])),e[9]),e[67]],e[55]=b[0],e[56]=b[1],e[57]=b[2],e[58]=b[3],e[59]=b[4],e[60]=b[5],e[61]=b[6],b)})},function(a){return e[63]=new d.Map(),e[63].set("task_id",e[55]),e[63].set("queue_name",e[56]),e[63].set("enqueue_timestamp_ms",e[57]),e[63].set("priority",e[58]),e[63].set("first_executed_timestamp_ms",e[59]),e[63].set("execution_time_ns",e[60]),e[63].set("echo_encoding_execution_time_ns",e[61]),e[64]=new d.Map(),e[64].set("task_metadata",e[63]),e[64].set("action_type",e[42]),e[64].set("content_type",e[41]),e[64].set("identifiers",e[35]),e[64].set("task_creation_source",void 0),e[64].set("message_payload_source",d.i64.cast([0,2])),e[65]=d.createArray(),a=[void 0,e[50],e[64],e[65]],e[51]=a[0],e[52]=a[1],e[53]=a[2],e[54]=a[3],a}])},function(a){return a=[e[51],e[52],e[53],e[54]],e[36]=a[0],e[37]=a[1],e[38]=a[2],e[39]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[59]=d.i64.of_float(Date.now()),d.i64.eq(e[45],d.i64.cast([0,0]))||d.i64.eq(e[45],void 0)?e[60]=void 0:e[60]=e[45],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[59],d.i64.cast([0,1e6])),e[9]),e[60]],e[47]=b[0],e[48]=b[1],e[49]=b[2],e[50]=b[3],e[51]=b[4],e[52]=b[5],e[53]=b[6],b):(f=c.item,e[59]=d.i64.of_float(Date.now()),d.i64.eq(e[45],d.i64.cast([0,0]))||d.i64.eq(e[45],void 0)?e[60]=void 0:e[60]=e[45],b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[59],d.i64.cast([0,1e6])),e[9]),e[60]],e[47]=b[0],e[48]=b[1],e[49]=b[2],e[50]=b[3],e[51]=b[4],e[52]=b[5],e[53]=b[6],b)})},function(a){return e[55]=new d.Map(),e[55].set("task_id",e[47]),e[55].set("queue_name",e[48]),e[55].set("enqueue_timestamp_ms",e[49]),e[55].set("priority",e[50]),e[55].set("first_executed_timestamp_ms",e[51]),e[55].set("execution_time_ns",e[52]),e[55].set("echo_encoding_execution_time_ns",e[53]),e[56]=new d.Map(),e[56].set("task_metadata",e[55]),e[56].set("action_type",e[42]),e[56].set("content_type",e[41]),e[56].set("identifiers",e[35]),e[56].set("task_creation_source",void 0),e[56].set("message_payload_source",d.i64.cast([0,2])),e[57]=new d.Map(),e[57].set("error_code",e[46]),e[57].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[57].set("error_message",""),e[58]=d.createArray(),a=[void 0,e[57],e[56],e[58]],e[36]=a[0],e[37]=a[1],e[38]=a[2],e[39]=a[3],a}])},function(a){return a=[e[36],e[37],e[38],e[39]],e[29]=a[0],e[30]=a[1],e[31]=a[2],e[32]=a[3],a}]))})},function(a){return a=[e[29],e[30],e[31],e[32]],e[21]=a[0],e[22]=a[1],e[23]=a[2],e[24]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[41]=d.i64.of_float(Date.now()),b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[41],d.i64.cast([0,1e6])),e[9]),void 0],e[29]=b[0],e[30]=b[1],e[31]=b[2],e[32]=b[3],e[33]=b[4],e[34]=b[5],e[35]=b[6],b):(f=c.item,e[41]=d.i64.of_float(Date.now()),b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[41],d.i64.cast([0,1e6])),e[9]),void 0],e[29]=b[0],e[30]=b[1],e[31]=b[2],e[32]=b[3],e[33]=b[4],e[34]=b[5],e[35]=b[6],b)})},function(a){return e[37]=new d.Map(),e[37].set("task_id",e[29]),e[37].set("queue_name",e[30]),e[37].set("enqueue_timestamp_ms",e[31]),e[37].set("priority",e[32]),e[37].set("first_executed_timestamp_ms",e[33]),e[37].set("execution_time_ns",e[34]),e[37].set("echo_encoding_execution_time_ns",e[35]),e[38]=new d.Map(),e[38].set("task_metadata",e[37]),e[38].set("action_type",void 0),e[38].set("content_type",void 0),e[38].set("identifiers",void 0),e[38].set("task_creation_source",void 0),e[38].set("message_payload_source",d.i64.cast([0,2])),e[39]=new d.Map(),e[39].set("error_code",d.i64.cast([0,24])),e[39].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[39].set("error_message",""),e[40]=d.createArray(),a=[void 0,e[39],e[38],e[40]],e[21]=a[0],e[22]=a[1],e[23]=a[2],e[24]=a[3],a}])},function(a){return a=[e[21],e[22],e[23],e[24]],e[13]=a[0],e[14]=a[1],e[15]=a[2],e[16]=a[3],a}]))})},function(a){return a=[e[13],e[14],e[15],e[16]],e[2]=a[0],e[3]=a[1],e[4]=a[2],e[5]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(b,c){var f=b.done;b=b.value;return f?(e[25]=d.i64.of_float(Date.now()),f=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[25],d.i64.cast([0,1e6])),e[9]),void 0],e[13]=f[0],e[14]=f[1],e[15]=f[2],e[16]=f[3],e[17]=f[4],e[18]=f[5],e[19]=f[6],f):(c=b.item,e[25]=d.i64.of_float(Date.now()),f=[a[0],c.queueName,c.enqueueTimestampMs,c.priority,c.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[25],d.i64.cast([0,1e6])),e[9]),void 0],e[13]=f[0],e[14]=f[1],e[15]=f[2],e[16]=f[3],e[17]=f[4],e[18]=f[5],e[19]=f[6],f)})},function(a){return e[21]=new d.Map(),e[21].set("task_id",e[13]),e[21].set("queue_name",e[14]),e[21].set("enqueue_timestamp_ms",e[15]),e[21].set("priority",e[16]),e[21].set("first_executed_timestamp_ms",e[17]),e[21].set("execution_time_ns",e[18]),e[21].set("echo_encoding_execution_time_ns",e[19]),e[22]=new d.Map(),e[22].set("task_metadata",e[21]),e[22].set("action_type",void 0),e[22].set("content_type",void 0),e[22].set("identifiers",void 0),e[22].set("task_creation_source",void 0),e[22].set("message_payload_source",d.i64.cast([0,2])),e[23]=new d.Map(),e[23].set("error_code",d.i64.cast([0,4])),e[23].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[23].set("error_message",""),e[24]=d.createArray(),a=[void 0,e[23],e[22],e[24]],e[2]=a[0],e[3]=a[1],e[4]=a[2],e[5]=a[3],a}])},function(a){return e[6]=d.i64.of_float(Date.now()),e[7]=d.i64.random(),e[10]="Finishing execution. Execution time: ",e[11]=d.i64.to_string(d.i64.sub(e[6],e[0])),e[12]=" ms",e[8]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][serializeBackupPayloadV2] ",e[8],e[10],e[8],e[11],e[8],e[12]].join("")),d.i64.eq(d.i64.mod_(e[7],d.i64.cast([0,100])),d.i64.cast([0,0]))?(e[13]=",",e[14]=d.createArray(),void 0!==void 0?e[15]=(e[14].push(void 0),e[14]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"serializeBackupPayloadV2",[e[10],e[13],e[11],e[13],e[12]].join(""),e[14],d.i64.cast([0,4]))):d.resolve()},function(a){return a=[e[2],e[3],e[4],e[5]],f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],a}])},function(a){return d.resolve(f)}])}d=a;g["default"]=d}),98);
__d("LSTaskSerializerEncryptedBackupsUpload",["LSArrayGetObjectAt","LSLogMebClientEvent.nop","LSSerializeBackupPayloadV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsUpload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.forEach(c.db.table(177).fetch([[[a[0]]],"fk_pending_tasks"]),function(a){var b=a.update;a.item;return b({backupStatus:c.i64.cast([0,2])})})},function(e){return c.storedProcedure(b("LSSerializeBackupPayloadV2"),a[0]).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],a})},function(a){return d[6]=c.i64.of_int32(d[5].length),c.i64.gt(d[6],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[5],c.i64.cast([0,0])).then(function(a){return a=a,d[20]=a[0],d[21]=a[1],a})},function(a){return d[7]=d[20]}]):c.resolve(d[7]=void 0)},function(a){return d[2]?d[8]=!1:d[8]=!0,d[8]?(d[3]?d[20]=!1:d[20]=!0,d[20]?(a=[void 0,void 0,d[7],d[4]],d[21]=a[0],d[22]=a[1],d[23]=a[2],d[24]=a[3],a):(a=[void 0,d[3],d[7],d[4]],d[21]=a[0],d[22]=a[1],d[23]=a[2],d[24]=a[3],a),a=[d[21],d[22],d[23],d[24]],d[9]=a[0],d[10]=a[1],d[11]=a[2],d[12]=a[3],a):(d[20]=d[2].get("payload"),d[2],a=[d[20],void 0,d[7],d[4]],d[9]=a[0],d[10]=a[1],d[11]=a[2],d[12]=a[3],a),d[20]=new c.Map(),d[21]=d[20].set("success",d[9]),d[22]=d[20].set("failure",d[10]),d[23]=d[20].set("protobuf_failure",d[11]),d[24]=d[20].set("context",d[12]),d[25]=c.toJSON(d[20]),d[13]=d[25],d[14]=c.i64.of_float(Date.now()),d[15]=c.i64.random(),d[17]="Finishing execution. Execution time: ",d[18]=c.i64.to_string(c.i64.sub(d[14],d[0])),d[19]=" ms",d[16]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsUpload] ",d[16],d[17],d[16],d[18],d[16],d[19]].join("")),c.i64.eq(c.i64.mod_(d[15],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[20]=",",d[21]=c.createArray(),void 0!==void 0?d[22]=(d[21].push(void 0),d[21]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsUpload",[d[17],d[20],d[18],d[20],d[19]].join(""),d[21],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[13],c.i64.cast([0,50026])],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSLoadProtobufBackupSerializedPayloadData",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSEncryptIdentifiers","LSGetBlobFromString.nop","LSGetLatestEpochKeys","LSIsEncryptionVersionSecure","LSLoadAndEncryptProtobuf","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadProtobufBackupSerializedPayloadData] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[19]=c.i64.mul(d[1],c.i64.cast([0,1e6])),c.db.table(2).fetch([[[a[0]]]]).next().then(function(b,e){var f=b.done;b=b.value;return f?(d[23]=c.i64.of_float(Date.now()),f=[a[0],void 0,void 0,void 0,void 0,c.i64.sub(c.i64.mul(d[23],c.i64.cast([0,1e6])),d[19]),void 0],d[2]=f[0],d[3]=f[1],d[4]=f[2],d[5]=f[3],d[6]=f[4],d[7]=f[5],d[8]=f[6],f):(e=b.item,d[23]=c.i64.of_float(Date.now()),f=[a[0],e.queueName,e.enqueueTimestampMs,e.priority,e.firstExecutedTimestampMs,c.i64.sub(c.i64.mul(d[23],c.i64.cast([0,1e6])),d[19]),void 0],d[2]=f[0],d[3]=f[1],d[4]=f[2],d[5]=f[3],d[6]=f[4],d[7]=f[5],d[8]=f[6],f)})},function(e){return d[10]=new c.Map(),d[10].set("task_id",d[2]),d[10].set("queue_name",d[3]),d[10].set("enqueue_timestamp_ms",d[4]),d[10].set("priority",d[5]),d[10].set("first_executed_timestamp_ms",d[6]),d[10].set("execution_time_ns",d[7]),d[10].set("echo_encoding_execution_time_ns",d[8]),d[11]=new c.Map(),d[11].set("task_metadata",d[10]),d[11].set("action_type",void 0),d[11].set("content_type",void 0),d[11].set("identifiers",void 0),d[11].set("task_creation_source",void 0),d[11].set("message_payload_source",c.i64.cast([0,2])),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?(d[23]=new c.Map(),d[23].set("error_code",c.i64.cast([0,1])),d[23].set("stored_procedure","LSEncryptedBackupsLoadProtobufBackupSerializedPayloadDataStoredProcedure"),d[23].set("error_message",""),g=[void 0,d[23],d[11]],d[12]=g[0],d[13]=g[1],d[14]=g[2],g):(f=e.item,c.sequence([function(a){return d[31]=f.mailboxRootKeyBlob,d[32]=f.deviceId,d[30]=f.backupTenancy,d[29]=f.encryptionVersion,c.i64.neq(void 0,void 0)?c.resolve(d[23]=void 0):c.sequence([function(a){return d[33]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[43]=(d[33].push(c.i64.cast([0,0])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[43]=(d[33].push(c.i64.cast([0,2])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[43]=(d[33].push(c.i64.cast([0,3])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[43]=(d[33].push(c.i64.cast([0,4])),d[33]):0,d[38]=c.createArray(),d[39]=c.i64.of_int32(d[33].length),c.i64.gt(d[39],c.i64.cast([0,0]))?c.loopAsync(d[39],function(a){return d[43]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[33],d[43]).then(function(a){return a=a,d[44]=a[0],d[45]=a[1],a})},function(a){return d[46]=(d[38].push(d[44]),d[38])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[43]=c.createArray(),d[44]=c.i64.of_int32(d[38].length),c.i64.gt(d[44],c.i64.cast([0,0]))?c.loopAsync(d[44],function(a){return d[46]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[38],d[46]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return d[49]=(d[43].push(c.i64.to_string(d[47])),d[43])}])}):c.resolve()},function(a){return d[45]=d[43].join(","),d[40]=d[45]}])},function(a){return d[38].some(function(a){return c.i64.eq(d[29],a)})?d[41]=d[29]:d[41]=void 0,c.i64.neq(d[41],void 0)?d[42]=d[41]:d[42]=void 0,d[23]=d[42]}])},function(e){return c.i64.neq(d[23],void 0)?d[24]=d[23]:d[24]=c.i64.cast([0,0]),c.i64.neq(d[30],void 0)?d[25]=d[30]:d[25]=c.i64.cast([0,1]),c.i64.neq(d[32],void 0)?c.sequence([function(e){return c.filter(c.db.table(305).fetch(),function(b){return c.i64.eq(b.pendingBackupTaskId,a[0])}).next().then(function(h,i){var e=h.done;h=h.value;return e?(d[37]=new c.Map(),d[37].set("error_code",c.i64.cast([0,5])),d[37].set("stored_procedure","LSEncryptedBackupsLoadProtobufBackupSerializedPayloadDataStoredProcedure"),d[37].set("error_message",""),e=[void 0,d[37],d[11]],d[33]=e[0],d[34]=e[1],d[35]=e[2],e):(i=h.item,c.sequence([function(b){return d[55]=i.actThreadId,d[37]=new c.Map(),d[37].set("backup_id",c.i64.to_string(f.backupId)),d[37].set("act_thread_id",d[55]),d[37].set("server_thread_id",d[55]),d[37].set("timestamp",c.i64.to_string(i.messageTimestampMs)),d[37].set("otid",i.toplevelOfflineThreadingId),c.db.table(2).fetch([[[a[0]]]]).next().then(function(e,f){var b=e.done;e=e.value;return b?(d[56]=c.i64.of_float(Date.now()),b=[a[0],void 0,void 0,void 0,void 0,c.i64.sub(c.i64.mul(d[56],c.i64.cast([0,1e6])),d[19]),void 0],d[38]=b[0],d[39]=b[1],d[40]=b[2],d[41]=b[3],d[42]=b[4],d[43]=b[5],d[44]=b[6],b):(f=e.item,d[56]=c.i64.of_float(Date.now()),b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,c.i64.sub(c.i64.mul(d[56],c.i64.cast([0,1e6])),d[19]),void 0],d[38]=b[0],d[39]=b[1],d[40]=b[2],d[41]=b[3],d[42]=b[4],d[43]=b[5],d[44]=b[6],b)})},function(a){return d[46]=new c.Map(),d[46].set("task_id",d[38]),d[46].set("queue_name",d[39]),d[46].set("enqueue_timestamp_ms",d[40]),d[46].set("priority",d[41]),d[46].set("first_executed_timestamp_ms",d[42]),d[46].set("execution_time_ns",d[43]),d[46].set("echo_encoding_execution_time_ns",d[44]),d[47]=new c.Map(),d[47].set("task_metadata",d[46]),d[47].set("action_type",c.i64.cast([0,1])),d[47].set("content_type",c.i64.cast([0,1])),d[47].set("identifiers",d[37]),d[47].set("task_creation_source",void 0),d[47].set("message_payload_source",c.i64.cast([0,2])),c.storedProcedure(b("LSGetLatestEpochKeys"),!1).then(function(a){return a=a,d[48]=a[0],d[49]=a[1],a})},function(a){return d[48]!==void 0?c.sequence([function(a){return c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,1]))?c.sequence([function(a){return d[59]=d[37].get("act_thread_id"),d[37],d[60]=c.createArray(),d[65]=(d[60].push(c.i64.cast([0,32])),d[60]),c.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",d[59]].join("")).then(function(a){return a=a,d[61]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[61],void 0,d[31],d[60]).then(function(a){return a=a,d[62]=a[0],a})},function(a){return d[62]?d[63]=!1:d[63]=!0,d[63]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),d[65]=c.createArray(),void 0!==void 0?d[66]=(d[65].push(void 0),d[65]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",d[65],c.i64.cast([0,3]))},function(a){return d[64]=void 0}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[62],c.i64.cast([0,0])).then(function(a){return a=a,d[65]=a[0],d[66]=a[1],a})},function(a){return d[64]=d[65]}])},function(a){return d[56]=d[64]}]):c.sequence([function(a){return c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,2]))?c.sequence([function(a){return d[60]=d[37].get("otid"),d[37],d[61]=c.createArray(),d[66]=(d[61].push(c.i64.cast([0,32])),d[61]),c.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",d[60]].join("")).then(function(a){return a=a,d[62]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[62],void 0,d[31],d[61]).then(function(a){return a=a,d[63]=a[0],a})},function(a){return d[63]?d[64]=!1:d[64]=!0,d[64]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),d[66]=c.createArray(),void 0!==void 0?d[67]=(d[66].push(void 0),d[66]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",d[66],c.i64.cast([0,3]))},function(a){return d[65]=void 0}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[63],c.i64.cast([0,0])).then(function(a){return a=a,d[66]=a[0],d[67]=a[1],a})},function(a){return d[65]=d[66]}])},function(a){return d[59]=d[65]}]):c.resolve(d[59]=void 0)},function(a){return d[56]=d[59]}])},function(a){return c.blobs.neq(d[56],void 0)?c.sequence([function(a){return d[59]=d[48].get("epoch_keys"),d[48],d[60]=d[59].get("epoch_anon_id"),d[59],d[61]=d[59].get("epoch_root_key"),d[59],d[62]=d[37].get("act_thread_id"),d[37],d[63]=c.createArray(),d[74]=(d[63].push(c.i64.cast([0,32])),d[63]),c.i64.ge(d[24],c.i64.cast([0,3]))?c.resolve(d[64]=void 0):c.sequence([function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[62]).then(function(a){return a=a,d[74]=a[0],a})},function(a){return d[64]=d[74]}])},function(a){return c.i64.ge(d[24],c.i64.cast([0,4]))?(d[74]="_",d[65]=["message_key_in_epoch",d[74],c.blobs.to_string(d[60]),d[74],"cipher_version",d[74],c.i64.to_string(d[24]),d[74],"thread",d[74],d[62]==null?"":d[62]].join("")):(c.i64.ge(d[24],c.i64.cast([0,3]))?(d[75]="_",d[74]=["message_key_in_epoch",d[75],c.blobs.to_string(d[60]),d[75],"cipher_version",d[75],c.i64.to_string(d[24]),d[75],"thread",d[75],d[62]==null?"":d[62]].join("")):(c.i64.ge(d[24],c.i64.cast([0,2]))?(d[76]="_",d[75]=["message_key_in_epoch",d[76],c.blobs.to_string(d[60]),d[76],"cipher_version",d[76],c.i64.to_string(d[24])].join("")):d[75]=["message_key_in_epoch","_",c.blobs.to_string(d[60])].join(""),d[74]=d[75]),d[65]=d[74]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[65]).then(function(a){return a=a,d[66]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[66],d[64],d[61],d[63]).then(function(a){return a=a,d[67]=a[0],a})},function(a){return d[67]?d[68]=!1:d[68]=!0,d[68]?c.resolve(d[69]=void 0):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[67],c.i64.cast([0,0])).then(function(a){return a=a,d[74]=a[0],d[75]=a[1],a})},function(a){return d[69]=d[74]}])},function(a){return c.filter(c.db.table(169).fetch(),function(a){return c.blobs.eq(a.epochAnonIdBlob,c.blob("MA=="))}).next().then(function(e,f){var a=e.done;e=e.value;return a?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTableUtils] Failed to get mailbox_root_key_v2: epoch 0 is not available."),d[74]=c.createArray(),void 0!==void 0?d[75]=(d[74].push(void 0),d[74]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTableUtils","Failed to get mailbox_root_key_v2: epoch 0 is not available.",d[74],c.i64.cast([0,3]))},function(a){return d[70]=void 0}]):(f=e.item,c.sequence([function(a){return d[74]=c.createArray(),d[82]=(d[74].push(c.i64.cast([0,32])),d[74]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5zYWx0X21haWxib3hfcm9vdF9rZXlfdjI="),void 0,d[31],d[74]).then(function(a){return a=a,d[75]=a[0],a})},function(a){return d[75]!==void 0?c.sequence([function(a){return d[82]=c.i64.of_int32(d[75].length),c.i64.ge(d[82],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[75],c.i64.cast([0,0])).then(function(a){return a=a,d[84]=a[0],d[85]=a[1],a})},function(a){return d[83]=d[84]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[84]=c.createArray(),void 0!==void 0?d[85]=(d[84].push(void 0),d[84]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[84],c.i64.cast([0,3]))},function(a){return d[83]=void 0}])},function(a){return d[76]=d[83]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[82]=c.createArray(),void 0!==void 0?d[83]=(d[82].push(void 0),d[82]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[82],c.i64.cast([0,3]))},function(a){return d[76]=void 0}])},function(a){return c.blobs.neq(d[76],void 0)?d[77]=!0:d[77]=!1,d[77]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),d[78]=c.createArray(),d[82]=(d[78].push(c.i64.cast([0,32])),d[78]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5tYWlsYm94X3Jvb3Rfa2V5X3Yy"),d[76],f.epochRootKeyBlob,d[78]).then(function(a){return a=a,d[79]=a[0],a})},function(a){return d[79]!==void 0?c.sequence([function(a){return d[82]=c.i64.of_int32(d[79].length),c.i64.ge(d[82],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[79],c.i64.cast([0,0])).then(function(a){return a=a,d[84]=a[0],d[85]=a[1],a})},function(a){return d[83]=d[84]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[84]=c.createArray(),void 0!==void 0?d[85]=(d[84].push(void 0),d[84]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[84],c.i64.cast([0,3]))},function(a){return d[83]=void 0}])},function(a){return d[80]=d[83]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[82]=c.createArray(),void 0!==void 0?d[83]=(d[82].push(void 0),d[82]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[82],c.i64.cast([0,3]))},function(a){return d[80]=void 0}])},function(a){return c.blobs.neq(d[80],void 0)?d[81]=!0:d[81]=!1,d[81]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),d[70]=d[80]}]))})},function(a){return c.blobs.neq(d[69],void 0)?c.sequence([function(a){return c.blobs.neq(d[70],void 0)?c.sequence([function(a){return d[80]=c.createArray(),d[84]=(d[80].push(c.i64.cast([0,32])),d[80]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5mYWxsYmFja19rZXk="),void 0,d[70],d[80]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[81]!==void 0?c.sequence([function(a){return d[84]=c.i64.of_int32(d[81].length),c.i64.ge(d[84],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[81],c.i64.cast([0,0])).then(function(a){return a=a,d[86]=a[0],d[87]=a[1],a})},function(a){return d[85]=d[86]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[86]=c.createArray(),void 0!==void 0?d[87]=(d[86].push(void 0),d[86]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[86],c.i64.cast([0,3]))},function(a){return d[85]=void 0}])},function(a){return d[82]=d[85]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[84]=c.createArray(),void 0!==void 0?d[85]=(d[84].push(void 0),d[84]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[84],c.i64.cast([0,3]))},function(a){return d[82]=void 0}])},function(a){return c.blobs.neq(d[82],void 0)?d[83]=!0:d[83]=!1,d[83]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),d[74]=d[82]}]):c.resolve(d[74]=void 0)},function(a){return d[75]=d[59].get("epoch_root_key"),d[59],d[76]=d[59].get("epoch_anon_id"),d[59],d[77]=d[59].get("epoch_id"),d[59],d[78]=new c.Map(),d[78].set("payload_key",d[69]),d[78].set("payload_fallback_key",d[74]),d[78].set("encryption_version",d[24]),d[78].set("epoch_root_key",d[75]),d[78].set("epoch_anon_id",d[76]),d[78].set("epoch_id",d[77]),d[79]=new c.Map(),d[79].set("ope_key",d[56]),d[79].set("message_payload_encryption_keys",d[78]),d[79].set("ocmf_shared_key",f.ocmfClientStateBlob),d[79].set("mailbox_base_salt",d[31]),d[79].set("mailbox_root_key_v2",d[70]),a=[d[79],void 0],d[72]=a[0],d[73]=a[1],a}]):c.resolve((d[74]=new c.Map(),d[74].set("error_code",c.i64.cast([0,26])),d[74].set("stored_procedure","MEBKeyDeriver"),d[74].set("error_message",""),a=[void 0,d[74]],d[72]=a[0],d[73]=a[1],a))},function(a){return a=[d[72],d[73]],d[57]=a[0],d[58]=a[1],a}]):c.resolve((d[59]=new c.Map(),d[59].set("error_code",c.i64.cast([0,25])),d[59].set("stored_procedure","MEBKeyDeriver"),d[59].set("error_message",""),a=[void 0,d[59]],d[57]=a[0],d[58]=a[1],a))},function(a){return a=[d[57],d[58]],d[50]=a[0],d[51]=a[1],a}]):c.resolve((a=[void 0,d[49]],d[50]=a[0],d[51]=a[1],a))},function(e){return d[50]!==void 0?c.sequence([function(a){return c.storedProcedure(b("LSEncryptIdentifiers"),c.i64.cast([0,1]),c.i64.cast([0,1]),d[37],d[50]).then(function(a){return a=a,d[56]=a[0],d[57]=a[1],a})},function(a){return d[58]=d[50].get("message_payload_encryption_keys"),d[50],d[59]=d[58].get("encryption_version"),d[58],d[60]=d[58].get("epoch_anon_id"),d[58],d[61]=d[58].get("epoch_root_key"),d[58],d[62]=d[37].get("act_thread_id"),d[37],d[63]=d[58].get("payload_key"),d[58],d[64]=d[37].get("backup_id"),d[37],d[65]=d[58].get("payload_fallback_key"),d[58],d[66]=c.createArray(),d[98]=(d[66].push(c.i64.cast([0,6])),d[66]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_anon_id_debug").then(function(a){return a=a,d[67]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[67],void 0,d[60],d[66]).then(function(a){return a=a,d[68]=a[0],a})},function(a){return d[68]?d[69]=!1:d[69]=!0,d[69]?c.resolve(d[70]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[68],c.i64.cast([0,0])).then(function(a){return a=a,d[98]=a[0],d[99]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[98]).then(function(a){return a=a,d[100]=a[0],a})},function(a){return d[70]=d[100]==null?"":d[100]}])},function(a){return d[71]=c.createArray(),d[98]=(d[71].push(c.i64.cast([0,6])),d[71]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_debug").then(function(a){return a=a,d[72]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[72],void 0,d[61],d[71]).then(function(a){return a=a,d[73]=a[0],a})},function(a){return d[73]?d[74]=!1:d[74]=!0,d[74]?c.resolve(d[75]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[73],c.i64.cast([0,0])).then(function(a){return a=a,d[98]=a[0],d[99]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[98]).then(function(a){return a=a,d[100]=a[0],a})},function(a){return d[75]=d[100]==null?"":d[100]}])},function(a){return d[76]=c.createArray(),d[98]=(d[76].push(c.i64.cast([0,6])),d[76]),c.nativeOperation(b("LSGetBlobFromString.nop"),"message_key_debug").then(function(a){return a=a,d[77]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[77],void 0,d[63],d[76]).then(function(a){return a=a,d[78]=a[0],a})},function(a){return d[78]?d[79]=!1:d[79]=!0,d[79]?c.resolve(d[80]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[78],c.i64.cast([0,0])).then(function(a){return a=a,d[98]=a[0],d[99]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[98]).then(function(a){return a=a,d[100]=a[0],a})},function(a){return d[80]=d[100]==null?"":d[100]}])},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[61]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),[d[81]==null?"":d[81],d[62]].join("")).then(function(a){return a=a,d[82]=a[0],a})},function(a){return d[83]=c.createArray(),d[98]=(d[83].push(c.i64.cast([0,6])),d[83]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_thread_id_debug").then(function(a){return a=a,d[84]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[84],void 0,d[82],d[83]).then(function(a){return a=a,d[85]=a[0],a})},function(a){return d[85]?d[86]=!1:d[86]=!0,d[86]?c.resolve(d[87]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[85],c.i64.cast([0,0])).then(function(a){return a=a,d[98]=a[0],d[99]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[98]).then(function(a){return a=a,d[100]=a[0],a})},function(a){return d[87]=d[100]==null?"":d[100]}])},function(a){return d[88]=":",d[97]=[d[70],d[88],d[75],d[88],d[80],d[88],d[87]].join(""),c.blobs.neq(d[61],void 0)?c.sequence([function(a){return d[98]=c.createArray(),d[104]=(d[98].push(c.i64.cast([0,18])),d[98]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[61],d[98]).then(function(a){return a=a,d[99]=a[0],a})},function(a){return d[99]!==void 0?c.sequence([function(a){return d[104]=c.i64.of_int32(d[99].length),c.i64.ge(d[104],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[99],c.i64.cast([0,0])).then(function(a){return a=a,d[106]=a[0],d[107]=a[1],a})},function(a){return d[105]=d[106]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[106]=c.createArray(),void 0!==void 0?d[107]=(d[106].push(void 0),d[106]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[106],c.i64.cast([0,3]))},function(a){return d[105]=void 0}])},function(a){return d[100]=d[105]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[104]=c.createArray(),void 0!==void 0?d[105]=(d[104].push(void 0),d[104]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[104],c.i64.cast([0,3]))},function(a){return d[100]=void 0}])},function(a){return c.blobs.neq(d[100],void 0)?d[101]=!0:d[101]=!1,d[101]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[100]).then(function(a){return a=a,d[102]=a[0],a})},function(a){return d[102]!==void 0?d[103]=d[102]:d[103]="encodingfailed",d[89]=d[103]}]):c.resolve(d[89]="null")},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[60]).then(function(a){return a=a,d[90]=a[0],a})},function(a){return d[96]=d[90]==null?"":d[90],c.blobs.neq(d[65],void 0)?c.sequence([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][MEBSerializationUtils] Including fallback encrypted epoch key in value_secret_ref."),c.nativeOperation(b("LSBase64Encode.nop"),d[61]).then(function(a){return a=a,d[98]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[65],c.blob("ZmFsbGJhY2tfZW5jcnlwdGVkX2Vwb2NoX2tleQ=="),d[98]==null?"":d[98]).then(function(a){return a=a,d[99]=a[0],a})},function(a){return d[99]!==void 0?d[100]=d[99]:d[100]="",d[101]=new c.Map(),d[101].set("encryption_version",d[59]),d[101].set("epoch_anon_id",d[96]),d[101].set("message_encryption_values",d[97]),d[101].set("fallback_encrypted_epoch_key",d[100]),d[101].set("root_key_fingerprint",d[89]),d[101].set("backup_id",d[64]),d[91]=d[101]}]):c.resolve((d[98]=new c.Map(),d[98].set("encryption_version",d[59]),d[98].set("epoch_anon_id",d[96]),d[98].set("message_encryption_values",d[97]),d[98].set("root_key_fingerprint",d[89]),d[98].set("backup_id",d[64]),d[91]=d[98]))},function(e){return d[92]=c.toJSON(d[91]),d[56]!==void 0?c.sequence([function(e){return c.storedProcedure(b("LSLoadAndEncryptProtobuf"),a[0],d[50],d[37]).then(function(a){return a=a,d[98]=a[0],d[99]=a[1],a})},function(a){return d[98]!==void 0?(d[103]=new c.Map(),d[103].set("protobuf_backup_payload",d[98]),d[103].set("encrypted_identifiers",d[56]),d[103].set("device_id",d[32]),d[103].set("identifiers",d[37]),d[103].set("encryption_keys",d[50]),d[103].set("content_type",c.i64.cast([0,1])),d[103].set("action_type",c.i64.cast([0,1])),d[103].set("value_secret_ref",d[92]),d[103].set("attachment_backup_payload",i.attachmentPayload),a=[d[103],void 0,d[47]],d[100]=a[0],d[101]=a[1],d[102]=a[2],a):(a=[void 0,d[99],d[47]],d[100]=a[0],d[101]=a[1],d[102]=a[2],a),a=[d[100],d[101],d[102]],d[93]=a[0],d[94]=a[1],d[95]=a[2],a}]):c.resolve((e=[void 0,d[57],d[47]],d[93]=e[0],d[94]=e[1],d[95]=e[2],e))},function(a){return a=[d[93],d[94],d[95]],d[52]=a[0],d[53]=a[1],d[54]=a[2],a}]):c.resolve((e=[void 0,d[51],d[47]],d[52]=e[0],d[53]=e[1],d[54]=e[2],e))},function(a){return a=[d[52],d[53],d[54]],d[33]=a[0],d[34]=a[1],d[35]=a[2],a}]))})},function(a){return a=[d[33],d[34],d[35]],d[26]=a[0],d[27]=a[1],d[28]=a[2],a}]):c.resolve((d[33]=new c.Map(),d[33].set("error_code",c.i64.cast([0,24])),d[33].set("stored_procedure","LSEncryptedBackupsLoadProtobufBackupSerializedPayloadDataStoredProcedure"),d[33].set("error_message",""),e=[void 0,d[33],d[11]],d[26]=e[0],d[27]=e[1],d[28]=e[2],e))},function(a){return a=[d[26],d[27],d[28]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]))})},function(a){return d[16]=c.i64.of_float(Date.now()),d[17]=c.i64.random(),d[20]="Finishing execution. Execution time: ",d[21]=c.i64.to_string(c.i64.sub(d[16],d[0])),d[22]=" ms",d[18]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadProtobufBackupSerializedPayloadData] ",d[18],d[20],d[18],d[21],d[18],d[22]].join("")),c.i64.eq(c.i64.mod_(d[17],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[23]=",",d[24]=c.createArray(),void 0!==void 0?d[25]=(d[24].push(void 0),d[24]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadProtobufBackupSerializedPayloadData",[d[20],d[23],d[21],d[23],d[22]].join(""),d[24],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[12],d[13],d[14]],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsUploadProtobufOnly",["LSBase64Encode.nop","LSLoadProtobufBackupSerializedPayloadData","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsUploadProtobufOnly] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSLoadProtobufBackupSerializedPayloadData"),a[0]).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],d[4]=a[2],a})},function(a){return d[2]!==void 0?c.sequence([function(a){return d[15]=d[2].get("encrypted_identifiers"),d[2],d[16]=d[2].get("identifiers"),d[2],d[17]=d[2].get("encryption_keys"),d[2],d[18]=d[2].get("protobuf_backup_payload"),d[2],d[19]=d[15].get("act_thread_id_ocmf_partial"),d[15],d[20]=d[15].get("otid_ocmf_partial"),d[15],d[21]=d[15].get("timestamp_encrypted"),d[15],d[22]=new c.Map(),d[22].set("list_key",d[19]),d[22].set("unique_key",d[20]),d[22].set("sort_key",d[21]),d[23]=d[2].get("value_secret_ref"),d[2],d[24]=new c.Map(),d[24].set("value",""),d[24].set("value_secret_ref",d[23]),d[25]=d[2].get("action_type"),d[2],d[26]=new c.Map(),d[26].set("list_item_id",d[22]),d[26].set("list_item",d[24]),d[26].set("action_type",d[25]),d[27]=d[16].get("server_thread_id"),d[16],d[28]=d[16].get("timestamp"),d[16],d[29]=d[16].get("otid"),d[16],d[30]=d[16].get("act_thread_id"),d[16],d[31]=new c.Map(),d[31].set("server_thread_key",d[27]),d[31].set("timestamp",d[28]),d[31].set("otid",d[29]),d[31].set("wa_thread_id",c.i64.from_string(d[30])),d[32]=d[17].get("mailbox_base_salt"),d[17],c.nativeOperation(b("LSBase64Encode.nop"),d[32]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[34]=d[17].get("ocmf_shared_key"),d[17],c.nativeOperation(b("LSBase64Encode.nop"),d[34]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[36]=new c.Map(),d[36].set("mailbox_root_key",d[33]==null?"":d[33]),d[36].set("ocmf_client_state_blob",d[35]==null?"":d[35]),d[37]=d[15].get("backup_id_ocmf_partial"),d[15],d[38]=d[2].get("device_id"),d[2],d[39]=d[17].get("message_payload_encryption_keys"),d[17],d[40]=d[39].get("epoch_id"),d[39],d[41]=d[17].get("message_payload_encryption_keys"),d[17],d[42]=d[41].get("encryption_version"),d[41],d[43]=d[2].get("content_type"),d[2],d[44]=new c.Map(),d[44].set("mailbox_partial_id",d[37]),d[44].set("action",d[26]),d[44].set("device_id",d[38]),d[44].set("echo_version",c.i64.cast([0,0])),d[44].set("epoch_id",d[40]),d[44].set("trace_id",void 0),d[44].set("encryption_version",d[42]),d[44].set("is_thread",c.i64.eq(d[43],c.i64.cast([0,2]))),d[44].set("raw_identifiers",d[31]),d[44].set("raw_tokens",d[36]),d[44].set("request_id",""),d[44].set("is_instamadillo",!0),d[45]=d[18].get("supplemental_data_encrypted"),d[18],d[45]!==void 0?c.sequence([function(a){return d[49]=d[18].get("protobuf_encrypted"),d[18],d[50]=d[18].get("backup_action"),d[18],d[51]=d[18].get("timestamp_ms"),d[18],d[52]=d[45].get("sk_ciphertext"),d[45],c.nativeOperation(b("LSBase64Encode.nop"),d[52]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[54]=d[45].get("sk_hash"),d[45],c.nativeOperation(b("LSBase64Encode.nop"),d[54]).then(function(a){return a=a,d[55]=a[0],a})},function(a){return d[56]=d[18].get("message_tags"),d[18],d[57]=new c.Map(),d[57].set("supplementary_data_key",void 0),d[57].set("encrypted_protobuf",d[49]),d[57].set("key_value_backup_action",d[50]),d[57].set("protobuf_ts_ms",d[51]),d[57].set("supplemental_key_ciphertext",d[53]),d[57].set("supplemental_key_hash",d[55]),d[57].set("message_tags",d[56]),d[46]=d[57]}]):c.resolve((d[49]=d[18].get("protobuf_encrypted"),d[18],d[50]=d[18].get("backup_action"),d[18],d[51]=d[18].get("timestamp_ms"),d[18],d[52]=d[18].get("message_tags"),d[18],d[53]=new c.Map(),d[53].set("supplementary_data_key",void 0),d[53].set("encrypted_protobuf",d[49]),d[53].set("key_value_backup_action",d[50]),d[53].set("protobuf_ts_ms",d[51]),d[53].set("message_tags",d[52]),d[46]=d[53]))},function(a){return d[44].set("key_value_backup_payload",d[46]),d[47]=d[2].get("attachment_backup_payload"),d[2],d[47]!==void 0?d[44].set("attachment_backup_payload",d[47]):0,d[48]=c.toJSON(d[44]),a=[d[48],void 0,d[4]],d[5]=a[0],d[6]=a[1],d[7]=a[2],a}]):c.resolve((d[3]?d[15]=!1:d[15]=!0,d[15]?(a=[void 0,void 0,d[4]],d[16]=a[0],d[17]=a[1],d[18]=a[2],a):(a=[void 0,d[3],d[4]],d[16]=a[0],d[17]=a[1],d[18]=a[2],a),a=[d[16],d[17],d[18]],d[5]=a[0],d[6]=a[1],d[7]=a[2],a))},function(a){return d[15]=new c.Map(),d[16]=d[15].set("success",d[5]),d[17]=d[15].set("failure",d[6]),d[18]=d[15].set("context",d[7]),d[19]=c.toJSON(d[15]),d[8]=d[19],d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsUploadProtobufOnly] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsUploadProtobufOnly",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[8],c.i64.cast([0,50042])],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSTaskSerializerMuteThreadV2",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[3]=b.createArray(),c[4]=(c[3].push("TaskSerializerMuteThreadV2: Task ID not found"),c[3]),c[5]=(c[3].push(a[0]),c[3]),c[6]=b.toJSON(c[3]),function(a){b.logger(a).mustfix(a)}(c[6]),f=[void 0,void 0],c[0]=f[0],c[1]=f[1],f):(e=d.item,b.sequence([function(a){return c[6]=e.threadKey,b.db.table(9).fetch([[[c[6]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?(c[7]=b.createArray(),c[8]=(c[7].push("TaskSerializerMuteThreadV2: Thread not found"),c[7]),c[9]=(c[7].push(c[6]),c[7]),c[10]=b.toJSON(c[7]),function(a){b.logger(a).mustfix(a)}(c[10]),a=[void 0,void 0],c[3]=a[0],c[4]=a[1],a):(e=d.item,b.sequence([function(a){return b.db.table(9).fetch([[[c[6]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[7]=b.i64.cast([0,1]):(e=d.item,c[12]=e.syncGroup,b.i64.neq(c[12],void 0)?c[11]=c[12]:c[11]=b.i64.cast([0,1]),c[7]=c[11])})},function(a){return c[9]=new b.Map(),c[9].set("thread_key",c[6]),c[9].set("mailbox_type",b.i64.cast([0,0])),c[9].set("mute_expire_time_ms",e.muteExpireTimeMs),c[9].set("sync_group",c[7]),c[10]=b.toJSON(c[9]),a=[c[10],b.i64.cast([0,144])],c[3]=a[0],c[4]=a[1],a}]))})},function(a){return a=[c[3],c[4]],c[0]=a[0],c[1]=a[1],a}]))})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSTaskSerializerRemoveThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[3]=b.createArray(),c[4]=(c[3].push("TaskSerializerRemoveThreadV2: Task ID not found"),c[3]),c[5]=(c[3].push(a[0]),c[3]),c[6]=b.toJSON(c[3]),function(a){b.logger(a).mustfix(a)}(c[6]),f=[void 0,void 0],c[0]=f[0],c[1]=f[1],f):(e=d.item,c[5]=e.removeType,b.i64.neq(c[5],void 0)?(c[6]=new b.Map(),c[6].set("thread_key",e.threadKey),c[6].set("remove_type",c[5]),c[6].set("sync_group",e.syncGroup==null?b.i64.cast([0,1]):e.syncGroup),c[7]=b.toJSON(c[6]),f=[c[7],b.i64.cast([0,146])],c[3]=f[0],c[4]=f[1],f):(d=[void 0,void 0],c[3]=d[0],c[4]=d[1],d),e=[c[3],c[4]],c[0]=e[0],c[1]=e[1],e)})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSTaskSerializerSendMessageV2",["LSSymmetricEncryptionCreateEncryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(31).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[3]=b.createArray(),c[4]=(c[3].push("task ID not found"),c[3]),c[5]=(c[3].push(a[0]),c[3]),c[6]=b.toJSON(c[3]),function(a){b.logger(a).mustfix(a)}(c[6]),f=[void 0,void 0],c[0]=f[0],c[1]=f[1],f):(e=d.item,b.sequence([function(d){return c[9]=e.offlineThreadingId,c[10]=e.messageId,c[17]=e.threadAttributionSource,c[7]=e.platformRef,c[8]=e.platformToken,c[6]=e.replySourceId,c[11]=e.replySourceType,c[16]=e.sendType,c[12]=e.initiatingSource,c[13]=e.skipUrlPreviewGen,c[14]=e.textHasLinks,c[15]=e.multitabEnv,b.db.table(12).fetch([[[c[9]]],"optimistic"]).next().then(function(e,f){var d=e.done;e=e.value;return d?(c[18]=b.createArray(),c[19]=(c[18].push("OTID not found"),c[18]),c[20]=(c[18].push(c[9]),c[18]),c[21]=b.toJSON(c[18]),function(a){b.logger(a).mustfix(a)}(c[21]),d=[void 0,void 0],c[3]=d[0],c[4]=d[1],d):(f=e.item,b.sequence([function(d){return c[24]=f.text,c[21]=f.threadKey,c[25]=f.messageId,c[23]=f.stickerId,c[27]=f.mentionOffsets,c[28]=f.mentionLengths,c[22]=f.mentionIds,c[29]=f.mentionTypes,c[32]=f.replyType,c[30]=f.isForwarded,c[26]=f.forwardScore,c[31]=f.hotEmojiSize,b.db.table(9).fetch([[[c[21]]]]).next().then(function(e,g){var d=e.done;e=e.value;return d?(c[33]=b.createArray(),c[34]=(c[33].push("thread not found"),c[33]),c[35]=(c[33].push(c[21]),c[33]),c[36]=b.toJSON(c[33]),function(a){b.logger(a).mustfix(a)}(c[36]),d=[void 0,void 0],c[18]=d[0],c[19]=d[1],d):(g=e.item,b.sequence([function(d){return c[38]=g.threadName,c[33]=g.threadType,b.db.table(2).fetch([[[a[0]]]]).next().then(function(e,f){var d=e.done;e=e.value;return d?c[34]=!1:(f=e.item,b.sequence([function(d){return b.islc(b.db.table(2).fetch([[[f.queueName]],"queueNameTaskId"]),0,b.i64.to_float(b.i64.cast([0,1]))).next().then(function(e,f){var d=e.done;e=e.value;return d?c[39]=!1:(f=e.item,c[39]=b.i64.eq(f.taskId,a[0]))})},function(a){return c[34]=c[39]}]))})},function(a){return b.i64.eq(g.authorityLevel,b.i64.cast([0,20]))&&(b.i64.eq(c[33],b.i64.cast([0,2]))||b.i64.eq(c[33],b.i64.cast([0,5]))||b.i64.eq(c[33],b.i64.cast([0,26])))&&c[34]?b.sequence([function(a){return c[42]=c[16]==null?b.i64.cast([0,1]):c[16],b.db.table(9).fetch([[[c[21]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[39]=b.i64.cast([0,1]):(e=d.item,c[54]=e.syncGroup,b.i64.neq(c[54],void 0)?c[53]=c[54]:c[53]=b.i64.cast([0,1]),c[39]=c[53])})},function(a){return c[41]=new b.Map(),c[41].set("thread_id",c[21]),c[41].set("otid",c[9]),c[41].set("source",c[17]==null?b.i64.cast([0,0]):c[17]),c[41].set("send_type",b.i64.cast([0,1])),c[41].set("sync_group",c[39]),b.i64.eq(c[42],b.i64.cast([0,1]))?b.resolve(c[41].set("text",c[24])):b.i64.eq(c[42],b.i64.cast([0,2]))?b.resolve(b.i64.neq(c[23],void 0)?(c[41].set("sticker_id",c[23]),c[41].set("send_type",c[42])):0):b.i64.eq(c[42],b.i64.cast([0,7]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[53]=a[0],c[54]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[53]=a[0],c[54]=a[1],a)})},function(a){return c[53]!==void 0?b.i64.neq(c[54],void 0)?(c[41].set("url",c[53]),c[41].set("attribution_app_id",c[54]),c[41].set("send_type",c[42])):0:0}]):b.i64.eq(c[42],b.i64.cast([0,3]))?b.sequence([function(a){return c[41].set("text",c[24]),c[53]=b.createArray(),c[54]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[21],c[25]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[55]=a.offlineAttachmentId,c[56]=(c[53].push(b.i64.from_string(a.attachmentFbid)),c[53]),c[55]!==void 0?c[56]=(c[54].push(c[55]),c[54]):0})},function(a){return c[41].set("attachment_fbids",c[53]),b.i64.eq(c[42],b.i64.cast([0,9]))?c[41].set("offline_attachment_ids",c[54]):0,c[41].set("send_type",c[42])}]):b.i64.eq(c[42],b.i64.cast([0,9]))?b.sequence([function(a){return c[41].set("text",c[24]),c[53]=b.createArray(),c[54]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[21],c[25]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[55]=a.offlineAttachmentId,c[56]=(c[53].push(b.i64.from_string(a.attachmentFbid)),c[53]),c[55]!==void 0?c[56]=(c[54].push(c[55]),c[54]):0})},function(a){return c[41].set("attachment_fbids",c[53]),b.i64.eq(c[42],b.i64.cast([0,9]))?c[41].set("offline_attachment_ids",c[54]):0,c[41].set("send_type",c[42])}]):b.i64.eq(c[42],b.i64.cast([0,10]))?b.sequence([function(a){return c[41].set("text",c[24]),c[53]=b.createArray(),c[54]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[21],c[25]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[55]=a.offlineAttachmentId,c[56]=(c[53].push(b.i64.from_string(a.attachmentFbid)),c[53]),c[55]!==void 0?c[56]=(c[54].push(c[55]),c[54]):0})},function(a){return c[41].set("attachment_fbids",c[53]),b.i64.eq(c[42],b.i64.cast([0,9]))?c[41].set("offline_attachment_ids",c[54]):0,c[41].set("send_type",c[42])}]):b.i64.eq(c[42],b.i64.cast([0,4]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[53]=void 0:(d=b.item,c[53]=d.attachmentFbid)})},function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[55]=void 0:(d=b.item,c[55]=d.actionUrl)})},function(a){return c[53]!==void 0?(c[41].set("text",c[24]),c[55]!==void 0?c[41].set("url",c[55]):0,c[41].set("forwarded_share_id",c[53]),c[41].set("send_type",c[42])):0}]):b.i64.eq(c[42],b.i64.cast([0,5]))?b.resolve(c[10]!==void 0?(c[41].set("forwarded_msg_id",c[10]),c[41].set("send_type",c[42]),b.i64.neq(c[26],void 0)?c[41].set("forward_score",c[26]):0,c[41].set("strip_forwarded_msg_caption",!1)):0):b.i64.eq(c[42],b.i64.cast([0,6]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[53]=a[0],c[54]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[53]=a[0],c[54]=a[1],a)})},function(a){return c[53]!==void 0?(c[41].set("url",c[53]),c[41].set("text",c[24]),c[41].set("send_type",c[42])):0}]):b.i64.eq(c[42],b.i64.cast([0,11]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[53]=a[0],c[54]=a[1],a):(d=b.item,a=[d.actionUrl,d.attributionAppId],c[53]=a[0],c[54]=a[1],a)})},function(a){return c[53]!==void 0?(c[41].set("url",c[53]),c[41].set("send_type",c[42])):0}]):b.resolve(0)},function(a){return c[49]=c[6]===""?void 0:c[6],c[49]!==void 0?b.i64.neq(c[11],void 0)?(c[53]=new b.Map(),c[53].set("reply_source_id",c[49]),c[53].set("reply_source_type",c[11]),c[53].set("reply_type",c[32]==null?b.i64.cast([0,0]):c[32]),c[41].set("reply_metadata",c[53])):0:0,c[50]=c[22]===""?void 0:c[22],c[50]!==void 0?(c[53]=c[27]===""?void 0:c[27],c[53]!==void 0?(c[54]=c[28]===""?void 0:c[28],c[54]!==void 0?(c[55]=new b.Map(),c[55].set("mention_ids",c[50]),c[55].set("mention_offsets",c[53]),c[55].set("mention_lengths",c[54]),c[55].set("mention_types",c[29]===""?void 0:c[29]),c[41].set("mention_data",c[55])):0):0):0,c[30]!==void 0?c[41].set("is_forwarded",c[30]):0,c[51]=c[7]===""?void 0:c[7],c[51]!==void 0?c[41].set("platform_ref",c[51]):0,c[52]=c[8]===""?void 0:c[8],c[52]!==void 0?c[41].set("platform_token",c[52]):0,[b.i64.cast([0,1]),b.i64.cast([0,2])].some(function(a){return b.i64.eq(c[42],a)})?b.i64.neq(c[31],void 0)?c[41].set("hot_emoji_size",c[31]):0:0,b.i64.neq(c[12],void 0)?c[41].set("initiating_source",c[12]):0,c[13]!==void 0?c[41].set("skip_url_preview_gen",c[13]):0,b.resolve()},function(a){return c[14]!==void 0?c[41].set("text_has_links",c[14]):0,c[15]!==void 0?c[41].set("multitab_env",c[15]):0,c[43]=b.createArray(),b.forEach(b.db.table(14).fetch([[[c[21]]]]),function(a){a=a.item;return c[53]=(c[43].push(a.contactId),c[43])})},function(a){return c[44]=new b.Map(),c[44].set("participants",c[43]),c[44].set("send_payload",c[41]),c[38]!==void 0?c[44].set("thread_name",c[38]):0,b.db.table(312).fetch([[[c[21]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[45]=void 0:(d=b.item,c[45]=d.metadata)})},function(a){return c[44].set("thread_metadata",c[45]),b.forEach(b.db.table(9).fetch([[[g.threadKey]]]),function(a){var b=a.update;a.item;return b({otidOfFirstMessage:f.offlineThreadingId})})},function(a){return c[45]===void 0||!1?(b.i64.eq(c[33],b.i64.cast([0,5]))||b.i64.eq(c[33],b.i64.cast([0,26]))?(function(a){b.logger(a).mustfix(a)}("For Marketplace & community chat subthreads, thread metadata cannot be null"),a=[void 0,void 0],c[53]=a[0],c[54]=a[1],a):(c[55]=b.toJSON(c[44]),a=[c[55],b.i64.cast([0,130])],c[53]=a[0],c[54]=a[1],a),a=[c[53],c[54]],c[47]=a[0],c[48]=a[1],a):(b.i64.eq(c[33],b.i64.cast([0,5]))?(c[55]=b.toJSON(c[44]),a=[c[55],b.i64.cast([0,645])],c[53]=a[0],c[54]=a[1],a):(b.i64.eq(c[33],b.i64.cast([0,26]))?(c[57]=b.toJSON(c[44]),a=[c[57],b.i64.cast([0,696])],c[55]=a[0],c[56]=a[1],a):(c[57]=b.toJSON(c[44]),a=[c[57],b.i64.cast([0,645])],c[55]=a[0],c[56]=a[1],a),a=[c[55],c[56]],c[53]=a[0],c[54]=a[1],a),a=[c[53],c[54]],c[47]=a[0],c[48]=a[1],a),a=[c[47],c[48]],c[36]=a[0],c[37]=a[1],a}]):b.sequence([function(a){return c[42]=c[16]==null?b.i64.cast([0,1]):c[16],b.db.table(9).fetch([[[c[21]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[39]=b.i64.cast([0,1]):(e=d.item,c[49]=e.syncGroup,b.i64.neq(c[49],void 0)?c[48]=c[49]:c[48]=b.i64.cast([0,1]),c[39]=c[48])})},function(a){return c[41]=new b.Map(),c[41].set("thread_id",c[21]),c[41].set("otid",c[9]),c[41].set("source",c[17]==null?b.i64.cast([0,0]):c[17]),c[41].set("send_type",b.i64.cast([0,1])),c[41].set("sync_group",c[39]),b.i64.eq(c[42],b.i64.cast([0,1]))?b.resolve(c[41].set("text",c[24])):b.i64.eq(c[42],b.i64.cast([0,2]))?b.resolve(b.i64.neq(c[23],void 0)?(c[41].set("sticker_id",c[23]),c[41].set("send_type",c[42])):0):b.i64.eq(c[42],b.i64.cast([0,7]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[48]=a[0],c[49]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[48]=a[0],c[49]=a[1],a)})},function(a){return c[48]!==void 0?b.i64.neq(c[49],void 0)?(c[41].set("url",c[48]),c[41].set("attribution_app_id",c[49]),c[41].set("send_type",c[42])):0:0}]):b.i64.eq(c[42],b.i64.cast([0,3]))?b.sequence([function(a){return c[41].set("text",c[24]),c[48]=b.createArray(),c[49]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[21],c[25]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[50]=a.offlineAttachmentId,c[51]=(c[48].push(b.i64.from_string(a.attachmentFbid)),c[48]),c[50]!==void 0?c[51]=(c[49].push(c[50]),c[49]):0})},function(a){return c[41].set("attachment_fbids",c[48]),b.i64.eq(c[42],b.i64.cast([0,9]))?c[41].set("offline_attachment_ids",c[49]):0,c[41].set("send_type",c[42])}]):b.i64.eq(c[42],b.i64.cast([0,9]))?b.sequence([function(a){return c[41].set("text",c[24]),c[48]=b.createArray(),c[49]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[21],c[25]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[50]=a.offlineAttachmentId,c[51]=(c[48].push(b.i64.from_string(a.attachmentFbid)),c[48]),c[50]!==void 0?c[51]=(c[49].push(c[50]),c[49]):0})},function(a){return c[41].set("attachment_fbids",c[48]),b.i64.eq(c[42],b.i64.cast([0,9]))?c[41].set("offline_attachment_ids",c[49]):0,c[41].set("send_type",c[42])}]):b.i64.eq(c[42],b.i64.cast([0,10]))?b.sequence([function(a){return c[41].set("text",c[24]),c[48]=b.createArray(),c[49]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[21],c[25]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[50]=a.offlineAttachmentId,c[51]=(c[48].push(b.i64.from_string(a.attachmentFbid)),c[48]),c[50]!==void 0?c[51]=(c[49].push(c[50]),c[49]):0})},function(a){return c[41].set("attachment_fbids",c[48]),b.i64.eq(c[42],b.i64.cast([0,9]))?c[41].set("offline_attachment_ids",c[49]):0,c[41].set("send_type",c[42])}]):b.i64.eq(c[42],b.i64.cast([0,4]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[48]=void 0:(d=b.item,c[48]=d.attachmentFbid)})},function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[50]=void 0:(d=b.item,c[50]=d.actionUrl)})},function(a){return c[48]!==void 0?(c[41].set("text",c[24]),c[50]!==void 0?c[41].set("url",c[50]):0,c[41].set("forwarded_share_id",c[48]),c[41].set("send_type",c[42])):0}]):b.i64.eq(c[42],b.i64.cast([0,5]))?b.resolve(c[10]!==void 0?(c[41].set("forwarded_msg_id",c[10]),c[41].set("send_type",c[42]),b.i64.neq(c[26],void 0)?c[41].set("forward_score",c[26]):0,c[41].set("strip_forwarded_msg_caption",!1)):0):b.i64.eq(c[42],b.i64.cast([0,6]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[48]=a[0],c[49]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[48]=a[0],c[49]=a[1],a)})},function(a){return c[48]!==void 0?(c[41].set("url",c[48]),c[41].set("text",c[24]),c[41].set("send_type",c[42])):0}]):b.i64.eq(c[42],b.i64.cast([0,11]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[21],c[25]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[48]=a[0],c[49]=a[1],a):(d=b.item,a=[d.actionUrl,d.attributionAppId],c[48]=a[0],c[49]=a[1],a)})},function(a){return c[48]!==void 0?(c[41].set("url",c[48]),c[41].set("send_type",c[42])):0}]):b.resolve(0)},function(a){return c[44]=c[6]===""?void 0:c[6],c[44]!==void 0?b.i64.neq(c[11],void 0)?(c[48]=new b.Map(),c[48].set("reply_source_id",c[44]),c[48].set("reply_source_type",c[11]),c[48].set("reply_type",c[32]==null?b.i64.cast([0,0]):c[32]),c[41].set("reply_metadata",c[48])):0:0,c[45]=c[22]===""?void 0:c[22],c[45]!==void 0?(c[48]=c[27]===""?void 0:c[27],c[48]!==void 0?(c[49]=c[28]===""?void 0:c[28],c[49]!==void 0?(c[50]=new b.Map(),c[50].set("mention_ids",c[45]),c[50].set("mention_offsets",c[48]),c[50].set("mention_lengths",c[49]),c[50].set("mention_types",c[29]===""?void 0:c[29]),c[41].set("mention_data",c[50])):0):0):0,c[30]!==void 0?c[41].set("is_forwarded",c[30]):0,c[46]=c[7]===""?void 0:c[7],c[46]!==void 0?c[41].set("platform_ref",c[46]):0,c[47]=c[8]===""?void 0:c[8],c[47]!==void 0?c[41].set("platform_token",c[47]):0,[b.i64.cast([0,1]),b.i64.cast([0,2])].some(function(a){return b.i64.eq(c[42],a)})?b.i64.neq(c[31],void 0)?c[41].set("hot_emoji_size",c[31]):0:0,b.i64.neq(c[12],void 0)?c[41].set("initiating_source",c[12]):0,c[13]!==void 0?c[41].set("skip_url_preview_gen",c[13]):0,b.resolve()},function(a){return c[14]!==void 0?c[41].set("text_has_links",c[14]):0,c[15]!==void 0?c[41].set("multitab_env",c[15]):0,c[43]=b.toJSON(c[41]),a=[c[43],b.i64.cast([0,46])],c[36]=a[0],c[37]=a[1],a}])},function(a){return a=[c[36],c[37]],c[18]=a[0],c[19]=a[1],a}]))})},function(a){return a=[c[18],c[19]],c[3]=a[0],c[4]=a[1],a}]))})},function(a){return a=[c[3],c[4]],c[0]=a[0],c[1]=a[1],a}]))})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSTaskSerializerUpdateThreadName",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[3]=b.createArray(),c[4]=(c[3].push("taskSerializerUpdateThreadName: Task ID not found"),c[3]),c[5]=(c[3].push(a[0]),c[3]),c[6]=b.toJSON(c[3]),function(a){b.logger(a).mustfix(a)}(c[6]),f=[void 0,void 0],c[0]=f[0],c[1]=f[1],f):(e=d.item,b.sequence([function(a){return c[6]=e.threadKey,b.db.table(9).fetch([[[c[6]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?(c[7]=b.createArray(),c[8]=(c[7].push("taskSerializerUpdateThreadName: Thread not found"),c[7]),c[9]=(c[7].push(c[6]),c[7]),c[10]=b.toJSON(c[7]),function(a){b.logger(a).mustfix(a)}(c[10]),a=[void 0,void 0],c[3]=a[0],c[4]=a[1],a):(e=d.item,b.sequence([function(a){return b.db.table(9).fetch([[[c[6]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[7]=b.i64.cast([0,1]):(e=d.item,c[12]=e.syncGroup,b.i64.neq(c[12],void 0)?c[11]=c[12]:c[11]=b.i64.cast([0,1]),c[7]=c[11])})},function(a){return c[9]=new b.Map(),c[9].set("thread_key",c[6]),c[9].set("thread_name",e.threadName==null?"":e.threadName),c[9].set("sync_group",c[7]),c[10]=b.toJSON(c[9]),a=[c[10],b.i64.cast([0,32])],c[3]=a[0],c[4]=a[1],a}]))})},function(a){return a=[c[3],c[4]],c[0]=a[0],c[1]=a[1],a}]))})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSSerializeTaskImplWeb",["LSTaskSerializerAcsIssueNextSync","LSTaskSerializerE2eeMessageIntegrityCheckV2","LSTaskSerializerE2eeMetadataThreadIntegrityCheck","LSTaskSerializerEncryptedBackupAction","LSTaskSerializerEncryptedBackupsLoopingUpload","LSTaskSerializerEncryptedBackupsRestoreWithSerializer","LSTaskSerializerEncryptedBackupsUpload","LSTaskSerializerEncryptedBackupsUploadProtobufOnly","LSTaskSerializerMuteThreadV2","LSTaskSerializerRemoveThread","LSTaskSerializerSendMessageV2","LSTaskSerializerUnauthenticatedTask","LSTaskSerializerUpdateThreadName"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return a[1]==="46"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerSendMessageV2"),a[0]).then(function(a){return a=a,d[6]=a[0],d[7]=a[1],a})},function(a){return a=[d[6],c.i64.to_string(d[7]),void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],a}]):c.sequence([function(e){return a[1]==="144"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerMuteThreadV2"),a[0]).then(function(a){return a=a,d[9]=a[0],d[10]=a[1],a})},function(a){return a=[d[9],c.i64.to_string(d[10]),void 0],d[6]=a[0],d[7]=a[1],d[8]=a[2],a}]):c.sequence([function(e){return a[1]==="146"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerRemoveThread"),a[0]).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(a){return a=[d[12],c.i64.to_string(d[13]),void 0],d[9]=a[0],d[10]=a[1],d[11]=a[2],a}]):c.sequence([function(e){return a[1]==="32"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerUpdateThreadName"),a[0]).then(function(a){return a=a,d[15]=a[0],d[16]=a[1],a})},function(a){return a=[d[15],c.i64.to_string(d[16]),void 0],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]):c.sequence([function(e){return a[1]==="362"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerAcsIssueNextSync"),a[0]).then(function(a){return a=a,d[18]=a[0],d[19]=a[1],a})},function(a){return a=[d[18],c.i64.to_string(d[19]),void 0],d[15]=a[0],d[16]=a[1],d[17]=a[2],a}]):c.sequence([function(e){return a[1]==="50015"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsRestoreWithSerializer"),a[0]).then(function(a){return a=a,d[21]=a[0],d[22]=a[1],a})},function(a){return a=[d[21],c.i64.to_string(d[22]),void 0],d[18]=a[0],d[19]=a[1],d[20]=a[2],a}]):c.sequence([function(e){return a[1]==="319"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupAction"),a[0]).then(function(a){return a=a,d[24]=a[0],d[25]=a[1],a})},function(a){return a=[d[24],c.i64.to_string(d[25]),void 0],d[21]=a[0],d[22]=a[1],d[23]=a[2],a}]):c.sequence([function(e){return a[1]==="50026"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsUpload"),a[0]).then(function(a){return a=a,d[27]=a[0],d[28]=a[1],a})},function(a){return a=[d[27],c.i64.to_string(d[28]),void 0],d[24]=a[0],d[25]=a[1],d[26]=a[2],a}]):c.sequence([function(e){return a[1]==="50042"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsUploadProtobufOnly"),a[0]).then(function(a){return a=a,d[30]=a[0],d[31]=a[1],a})},function(a){return a=[d[30],c.i64.to_string(d[31]),void 0],d[27]=a[0],d[28]=a[1],d[29]=a[2],a}]):c.sequence([function(e){return a[1]==="700"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerE2eeMetadataThreadIntegrityCheck"),a[0]).then(function(a){return a=a,d[33]=a[0],d[34]=a[1],a})},function(a){return a=[d[33],c.i64.to_string(d[34]),void 0],d[30]=a[0],d[31]=a[1],d[32]=a[2],a}]):c.sequence([function(e){return a[1]==="705"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerE2eeMessageIntegrityCheckV2"),a[0]).then(function(a){return a=a,d[36]=a[0],d[37]=a[1],a})},function(a){return a=[d[36],c.i64.to_string(d[37]),void 0],d[33]=a[0],d[34]=a[1],d[35]=a[2],a}]):c.sequence([function(e){return a[1]==="50043"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsLoopingUpload"),a[0]).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(a){return a=[d[39],c.i64.to_string(d[40]),void 0],d[36]=a[0],d[37]=a[1],d[38]=a[2],a}]):c.resolve((e=[a[2],a[1],void 0],d[36]=e[0],d[37]=e[1],d[38]=e[2],e))},function(a){return a=[d[36],d[37],d[38]],d[33]=a[0],d[34]=a[1],d[35]=a[2],a}])},function(a){return a=[d[33],d[34],d[35]],d[30]=a[0],d[31]=a[1],d[32]=a[2],a}])},function(a){return a=[d[30],d[31],d[32]],d[27]=a[0],d[28]=a[1],d[29]=a[2],a}])},function(a){return a=[d[27],d[28],d[29]],d[24]=a[0],d[25]=a[1],d[26]=a[2],a}])},function(a){return a=[d[24],d[25],d[26]],d[21]=a[0],d[22]=a[1],d[23]=a[2],a}])},function(a){return a=[d[21],d[22],d[23]],d[18]=a[0],d[19]=a[1],d[20]=a[2],a}])},function(a){return a=[d[18],d[19],d[20]],d[15]=a[0],d[16]=a[1],d[17]=a[2],a}])},function(a){return a=[d[15],d[16],d[17]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}])},function(a){return a=[d[12],d[13],d[14]],d[9]=a[0],d[10]=a[1],d[11]=a[2],a}])},function(a){return a=[d[9],d[10],d[11]],d[6]=a[0],d[7]=a[1],d[8]=a[2],a}])},function(a){return a=[d[6],d[7],d[8]],d[0]=a[0],d[1]=a[1],d[2]=a[2],a}])},function(e){return a[3]?c.resolve((d[1]==="60009"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","60009"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[void 0,void 0,void 0],d[6]=e[0],d[7]=e[1],d[8]=e[2],e):(d[1]==="60006"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","60006"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[void 0,void 0,void 0],d[9]=e[0],d[10]=e[1],d[11]=e[2],e):(d[1]==="60008"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","60008"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[void 0,void 0,void 0],d[12]=e[0],d[13]=e[1],d[14]=e[2],e):(d[1]==="60011"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","60011"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[void 0,void 0,void 0],d[15]=e[0],d[16]=e[1],d[17]=e[2],e):(d[1]==="765"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","765"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[void 0,void 0,void 0],d[18]=e[0],d[19]=e[1],d[20]=e[2],e):(d[1]==="761"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","761"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[void 0,void 0,void 0],d[21]=e[0],d[22]=e[1],d[23]=e[2],e):(d[1]==="632"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","632"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[void 0,void 0,void 0],d[24]=e[0],d[25]=e[1],d[26]=e[2],e):(d[1]==="384"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","384"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[void 0,void 0,void 0],d[27]=e[0],d[28]=e[1],d[29]=e[2],e):(d[1]==="384"?(function(a){c.logger(a).mustfix(a)}(["Deidentified task with label ","384"," is being executed through the 'identified' path. This should never happen!"].join("")),e=[void 0,void 0,void 0],d[30]=e[0],d[31]=e[1],d[32]=e[2],e):(e=[d[0],d[1],d[2]],d[30]=e[0],d[31]=e[1],d[32]=e[2],e),e=[d[30],d[31],d[32]],d[27]=e[0],d[28]=e[1],d[29]=e[2],e),e=[d[27],d[28],d[29]],d[24]=e[0],d[25]=e[1],d[26]=e[2],e),e=[d[24],d[25],d[26]],d[21]=e[0],d[22]=e[1],d[23]=e[2],e),e=[d[21],d[22],d[23]],d[18]=e[0],d[19]=e[1],d[20]=e[2],e),e=[d[18],d[19],d[20]],d[15]=e[0],d[16]=e[1],d[17]=e[2],e),e=[d[15],d[16],d[17]],d[12]=e[0],d[13]=e[1],d[14]=e[2],e),e=[d[12],d[13],d[14]],d[9]=e[0],d[10]=e[1],d[11]=e[2],e),e=[d[9],d[10],d[11]],d[6]=e[0],d[7]=e[1],d[8]=e[2],e),e=[d[6],d[7],d[8]],d[3]=e[0],d[4]=e[1],d[5]=e[2],e)):c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerUnauthenticatedTask"),a[0],d[1],d[0]).then(function(a){return a=a,d[6]=a[0],d[7]=a[1],a})},function(a){return a=[d[6],c.i64.to_string(d[7]),void 0],d[3]=a[0],d[4]=a[1],d[5]=a[2],a}])},function(a){return a=[d[3],d[4],d[5]],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSSerializeTaskProxy",["LSSerializeTaskImplWeb"],(function(a,b,c,d,e,f,g){g["default"]=c("LSSerializeTaskImplWeb")}),98);
__d("LSSerializeTask",["LSSerializeTaskProxy"],(function(a,b,c,d,e,f,g){f.exports=c("LSSerializeTaskProxy")}),34);
__d("LSBeginHandlingPendingTasksForQueueImplWeb",["LSSerializeTask","gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(b){return d.filter(d.db.table(3).fetch([[[a[0]]]]),function(b){return d.i64.neq(b.epochId,void 0)&&b.taskQueueName===a[0]}).next().then(function(a,b){b=a.done;a=a.value;return b?e[0]=!1:(a.item,e[0]=!0)})},function(f){return e[2]=new d.Map(),e[2].set("queue_name",a[0]),e[2].set("next_sync_ms",void 0),e[2].set("work_item_type",d.i64.cast([0,4])),e[2].set("network_payload",void 0),e[2].set("http_url_override",void 0),e[2].set("skip_realtime_gateway",!1),e[3]=e[2],e[0]?d.resolve():d.sequence([function(b){return d.islc(d.db.table(2).fetch([[[a[0]]],"queueNameTaskId"]),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=["",d.i64.cast([-1,4294967295]),d.i64.cast([0,0]),d.i64.cast([-1,4294967295]),void 0,void 0],e[4]=c[0],e[5]=c[1],e[6]=c[2],e[7]=c[3],e[8]=c[4],e[9]=c[5],c):(b=a.item,c=[b.queueName,b.minTimeToSyncTimestampMs,b.pluginType,b.failureCount,b.context,b.httpUrlOverride],e[4]=c[0],e[5]=c[1],e[6]=c[2],e[7]=c[3],e[8]=c[4],e[9]=c[5],c)})},function(b){return d.db.table(3).fetch([[[a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[11]=d.i64.cast([0,0]):(b=a.item,e[11]=b.lastSyncRequestTimestampMs)})},function(f){return e[13]=d.i64.of_float(Date.now()),e[15]=d.i64.sub(e[5],e[13]),d.i64.le(e[15],d.i64.cast([0,0]))?(d.i64.eq(e[7],d.i64.cast([0,0]))||a[1]?e[16]=d.i64.cast([0,0]):(d.i64.gt(e[7],d.i64.cast([0,7]))?e[19]=d.i64.sub(e[7],d.i64.cast([0,7])):e[19]=e[7],e[20]=d.i64.sub(e[19],d.i64.cast([0,1])),e[21]=d.i64.mul(d.i64.lsl_(d.i64.cast([0,1]),d.i64.to_int32(d.i64.lt(e[20],d.i64.cast([0,7]))?e[20]:d.i64.cast([0,7]))),d.i64.cast([0,500])),e[16]=d.i64.lt(e[21],d.i64.cast([0,3e4]))?e[21]:d.i64.cast([0,3e4])),e[17]=d.i64.of_float(Date.now()),e[18]=d.i64.sub(d.i64.add(e[11],e[16]),e[17]),e[14]=d.i64.gt(e[18],d.i64.cast([0,0]))?e[18]:d.i64.cast([0,0])):e[14]=e[15],d.i64.neq(e[14],d.i64.cast([0,0]))?d.resolve((e[16]=new d.Map(),e[16].set("queue_name",a[0]),e[16].set("next_sync_ms",e[14]),e[16].set("work_item_type",d.i64.cast([0,3])),e[16].set("network_payload",void 0),e[16].set("http_url_override",void 0),e[16].set("skip_realtime_gateway",!1),e[3]=e[16])):d.sequence([function(a){return d.i64.neq(e[6],d.i64.cast([0,0]))||e[8]==="16"||e[8]==="4"?d.resolve((a=[e[4],void 0,d.i64.cast([0,2]),void 0,void 0,!1],e[16]=a[0],e[17]=a[1],e[18]=a[2],e[19]=a[3],e[20]=a[4],e[21]=a[5],a)):d.sequence([function(a){return e[23]=d.createArray(),e[24]=!0,d.islc(d.db.table(2).fetch([[[e[4]]],"queueNameTaskId"]),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=["",d.i64.cast([-1,4294967295]),d.i64.cast([0,0]),d.i64.cast([-1,4294967295]),void 0,void 0],e[25]=c[0],e[26]=c[1],e[27]=c[2],e[28]=c[3],e[29]=c[4],e[30]=c[5],c):(b=a.item,c=[b.queueName,b.minTimeToSyncTimestampMs,b.pluginType,b.failureCount,b.context,b.httpUrlOverride],e[25]=c[0],e[26]=c[1],e[27]=c[2],e[28]=c[3],e[29]=c[4],e[30]=c[5],c)})},function(a){return d.db.table(2).fetch([[[e[4]]],"queueNameTaskId"]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[32]=!0:(b=a.item,d.sequence([function(a){return d.db.table(306).fetch([[[b.taskId]]]).next().then(function(b,c){var a=b.done;b=b.value;return a?e[41]=!0:(c=b.item,e[41]=c.requiresAuthentication)})},function(a){return e[32]=e[41]}]))})},function(a){return d.forEach(d.db.table(2).fetch([[[e[4]]],"queueNameTaskId"]),function(a){var f=a.item;return d.sequence([function(a){return e[41]=f.taskId,e[42]=f.context,e[44]=f.failureCount,e[43]=f.timeoutTimestampMs,d.i64.eq(f.firstExecutedTimestampMs,d.i64.cast([0,0]))?(e[45]=d.i64.of_float(Date.now()),d.forEach(d.db.table(2).fetch([[[e[41]]]]),function(a){var b=a.update;a.item;return b({firstExecutedTimestampMs:e[45]})})):d.resolve()},function(a){return d.sequence([function(a){return d.db.table(306).fetch([[[e[41]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[45]=!0:(b=a.item,e[45]=b.requiresAuthentication)})},function(a){return e[24]=f.httpUrlOverride===e[30]&&e[45]===e[32]&&e[24],e[24]?d.sequence([function(a){return e[42]===void 0?d.sequence([function(a){return d.forEach(d.db.table(2).fetch([[[e[41]]]]),function(a){return a["delete"]()})},function(a){return e[47]=void 0}]):d.sequence([function(a){return d.i64.neq(e[43],void 0)?(e[54]=d.i64.of_float(Date.now()),e[52]=d.i64.ge(e[54],e[43])):e[52]=!1,e[52]?d.sequence([function(a){return d.forEach(d.db.table(2).fetch([[[e[41]]]]),function(a){return a["delete"]()})},function(a){return e[53]=void 0}]):d.sequence([function(a){return d.storedProcedure(b("LSSerializeTask"),e[41],e[42],f.taskValue,e[32]).then(function(a){return a=a,e[54]=a[0],e[55]=a[1],e[56]=a[2],a})},function(a){return e[54]!==void 0?(e[58]=new d.Map(),e[58].set("label",e[55]),e[58].set("payload",e[54]),e[58].set("queue_name",f.queueName),e[58].set("task_id",e[41]),e[58].set("failure_count",d.i64.eq(e[44],d.i64.cast([0,0]))?void 0:e[44]),e[57]=e[58]):e[57]=void 0,e[53]=e[57]}])},function(a){return e[47]=e[53]}])},function(a){return e[47]?e[48]=!1:e[48]=!0,e[48]?d.forEach(d.db.table(2).fetch([[[e[41]]]]),function(a){return a["delete"]()}):d.resolve(e[52]=(e[23].push(e[47]),e[23]))},function(a){return e[49]=d.i64.of_int32(e[23].length),c("gkx")("6280")&&e[42]==="207"?e[50]=d.i64.cast([0,50]):e[50]=d.i64.cast([0,5]),e[42]!==void 0?e[51]=["90","130","153"].includes(e[42]):e[51]=!1,e[24]=!(d.i64.ge(e[49],e[50])||e[51])}]):d.resolve()}])}])})},function(a){return e[34]=d.i64.of_int32(e[23].length),d.i64.eq(e[34],d.i64.cast([0,0]))?d.resolve((a=[e[4],void 0,d.i64.cast([0,4]),void 0,void 0,!1],e[35]=a[0],e[36]=a[1],e[37]=a[2],e[38]=a[3],e[39]=a[4],e[40]=a[5],a)):d.sequence([function(a){return e[41]=d.i64.of_float(Date.now()),e[42]=d.i64.random(),e[52]=d.i64.and_(d.i64.or_(d.i64.lsl_(e[41],d.i64.to_int32(d.i64.cast([0,22]))),d.i64.and_(e[42],d.i64.cast([0,4194303]))),d.i64.cast([2147483647,4294967295])),d.db.table(3).fetch([[[e[4],d.i64.cast([-1,4294967295])]]]).next().then(function(a,b){b=a.done;a=a.value;return b?(e[53]=d.i64.of_float(Date.now()),d.db.table(3).add({syncDatabaseId:d.i64.cast([-1,4294967295]),taskQueueName:e[4],failureCount:d.i64.cast([0,0]),lastSentTimestampMs:d.i64.cast([0,0]),lastSyncRequestTimestampMs:e[53],epochId:e[52]})):(a.item,e[53]=d.i64.of_float(Date.now()),d.forEach(d.db.table(3).fetch([[[e[4],d.i64.cast([-1,4294967295])]]]),function(a){var b=a.update;a.item;return b({epochId:e[52],lastSyncRequestTimestampMs:e[53]})}))})},function(a){return d.islc(d.db.table(2).fetch([[[e[4]]],"queueNameTaskId"]),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=["",d.i64.cast([-1,4294967295]),d.i64.cast([0,0]),d.i64.cast([-1,4294967295]),void 0,void 0],e[44]=c[0],e[45]=c[1],e[46]=c[2],e[47]=c[3],e[48]=c[4],e[49]=c[5],c):(b=a.item,c=[b.queueName,b.minTimeToSyncTimestampMs,b.pluginType,b.failureCount,b.context,b.httpUrlOverride],e[44]=c[0],e[45]=c[1],e[46]=c[2],e[47]=c[3],e[48]=c[4],e[49]=c[5],c)})},function(a){return e[51]=new d.Map(),e[51].set("tasks",e[23]),e[51].set("epoch_id",e[52]),a=[e[4],void 0,d.i64.cast([0,1]),e[51],e[49],!(e[49]===void 0)||d.i64.gt(e[47],d.i64.cast([0,7]))],e[35]=a[0],e[36]=a[1],e[37]=a[2],e[38]=a[3],e[39]=a[4],e[40]=a[5],a}])},function(a){return a=[e[35],e[36],e[37],e[38],e[39],e[40]],e[16]=a[0],e[17]=a[1],e[18]=a[2],e[19]=a[3],e[20]=a[4],e[21]=a[5],a}])},function(a){return e[22]=new d.Map(),e[22].set("queue_name",e[16]),e[22].set("next_sync_ms",e[17]),e[22].set("work_item_type",e[18]),e[22].set("network_payload",e[19]),e[22].set("http_url_override",e[20]),e[22].set("skip_realtime_gateway",e[21]),e[3]=e[22]}])}])},function(a){return f[0]=e[3]}])},function(a){return d.resolve(f)}])}d=a;g["default"]=d}),98);
__d("LSBeginHandlingPendingTasksForQueueProxy",["LSBeginHandlingPendingTasksForQueueImplWeb"],(function(a,b,c,d,e,f,g){g["default"]=c("LSBeginHandlingPendingTasksForQueueImplWeb")}),98);
__d("LSBeginHandlingPendingTasksForQueue",["LSBeginHandlingPendingTasksForQueueProxy"],(function(a,b,c,d,e,f,g){f.exports=c("LSBeginHandlingPendingTasksForQueueProxy")}),34);
__d("LSBeginHandlingPendingTasksForQueueStoredProcedure",["LSBeginHandlingPendingTasksForQueue"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.queueName;d[1]=b.ignoreSoftDelay;return c("LSBeginHandlingPendingTasksForQueue").apply(void 0,d.concat([a]))}g["default"]=a}),98);